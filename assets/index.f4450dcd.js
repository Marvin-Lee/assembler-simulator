var pn=Object.defineProperty,fn=Object.defineProperties;var gn=Object.getOwnPropertyDescriptors;var At=Object.getOwnPropertySymbols;var mn=Object.prototype.hasOwnProperty,Rn=Object.prototype.propertyIsEnumerable;var Je=(e,t,s)=>t in e?pn(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,A=(e,t)=>{for(var s in t||(t={}))mn.call(t,s)&&Je(e,s,t[s]);if(At)for(var s of At(t))Rn.call(t,s)&&Je(e,s,t[s]);return e},M=(e,t)=>fn(e,gn(t));var k=(e,t,s)=>(Je(e,typeof t!="symbol"?t+"":t,s),s);import{c as de,a as Z,b as as,g as bn,d as vn,e as En,r as R,j as n,f as u,F as G,u as Sn,h as _n,i as wn,E as xn,k as $,S as Ge,D as ve,l as ct,m as yn,n as Nn,G as In,R as Cn,o as Ln,A as Dn,p as An,L as kn,s as Mn,q as Tn,t as On,v as Gn,w as Bn,x as Pn,y as Un,z as Fn,B as Vn,C as Hn,H as Wn,I as Jn,J as zn,K as $n,M as jn,N as Kn,O as Xn,P as Zn,Q as Yn,T as qn}from"./vendor.629f42b9.js";const Qn=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))r(a);new MutationObserver(a=>{for(const o of a)if(o.type==="childList")for(const c of o.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&r(c)}).observe(document,{childList:!0,subtree:!0});function s(a){const o={};return a.integrity&&(o.integrity=a.integrity),a.referrerpolicy&&(o.referrerPolicy=a.referrerpolicy),a.crossorigin==="use-credentials"?o.credentials="include":a.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(a){if(a.ep)return;a.ep=!0;const o=s(a);fetch(a.href,o)}};Qn();const os=e=>e.sliceString(0),$e=(e,t)=>{const{from:s,to:r,number:a}=e.lineAt(t);return{from:s,to:r,number:a}},is=(e,t)=>e.from===t.from&&e.to===t.to,er=(e,t)=>e.from<t.to&&t.from<e.to;var kt=`; --------------------------------------
;	Untitled
; --------------------------------------
	
; --------------------------------------
	END
; --------------------------------------
`,tr=`; --------------------------------------
;	Procedures
; --------------------------------------
	MOV  AL, E0		; 1110 0000
Loop:
	NOT  AL			; Invert the bits in AL
	OUT  01			; Send data to traffic lights
	MOV  BL, 01		; Short delay
	CALL 30			; Call procedure 30

	NOT  AL			; Invert the bits in AL
	OUT  01			; Send data to traffic lights
	MOV  BL, 04		; Middle sized delay
	CALL 30			; Call procedure 30

	NOT  AL			; Invert the bits in AL
	OUT  01			; Send data to traffic lights
	MOV  BL, 08		; Longer delay
	CALL 30			; Call procedure 30
	JMP  Loop
; --------------------------------------
	ORG  30
Rep:
	DEC  BL			; Subtract one from BL
	JNZ  Rep
	RET
; --------------------------------------
	END
; --------------------------------------

For more examples, select File > Open Example.
`,sr=`; --------------------------------------
;	Software Interrupts
; --------------------------------------
	JMP Start		; Jump past the table of interrupt vectors
	DB   51			; Vector at 02 pointing to address 51
	DB   71			; Vector at 03 pointing to address 71
Start:
	INT  02			; Do interrupt 02
	INT  03			; Do interrupt 03
	JMP Start
; --------------------------------------
	ORG  50
	DB   E0
					; Interrupt code starts here
	MOV  AL, [50]	; Copy bits from RAM into AL
	NOT  AL			; Invert the bits in AL
	MOV [50], AL	; Copy inverted bits back to RAM
	OUT  01			; Send data to traffic lights
	IRET
; --------------------------------------
	ORG  70
	DB   FE
					; Interrupt code starts here
	MOV  AL, [70]	; Copy bits from RAM into AL
	NOT  AL			; Invert the bits in AL
	AND  AL,  FE	; Set the right most bit to zero
	MOV [70], AL	; Copy inverted bits back to RAM
	OUT  02			; Send data to seven-segment display
	IRET
; --------------------------------------
	END
; --------------------------------------

For more examples, select File > Open Example.
`,nr=`; --------------------------------------
;	Hardware Interrupts
; --------------------------------------
	JMP	 Start		; Jump past the table of interrupt vectors
	DB   50			; Vector at 02 pointing to address 50
Start:
	STI				; Set I flag. Enable hardware interrupts
	MOV	 AL,  30	; ASCII for '0'
Loop:
	MOV [C0], AL	; Copy the data in AL to the video RAM
	INC	 AL			; Add one to AL
	JMP	Loop
; --------------------------------------
	ORG	 50
	MOV  AL,  30	; Reset AL to ASCII for '0'
	IRET
; --------------------------------------
	END
; --------------------------------------

For more examples, select File > Open Example.
`,rr=`; --------------------------------------
;	Keyboard Input
; --------------------------------------
	MOV  BL, C0		; Make BL point to video RAM
Loop:
	IN   00			; Wait for keyboard input
	CMP  AL, 0D		; Check if the key was Enter (Carriage Return)
	JZ  Done
	MOV [BL], AL	; Copy the data in AL to the video RAM that BL points to
	INC  BL			; Make BL point to the next video RAM location
	JNZ Loop
Done:
; --------------------------------------
	END
; --------------------------------------

For more examples, select File > Open Example.
`,ar=`; --------------------------------------
;	Visual Display Unit
; --------------------------------------
	JMP Start		; Jump past the data table
	DB  "Hello World!"
	DB   00
Start:
	MOV  AL,  C0	; Make AL point to video RAM
	MOV  BL,  02	; Make BL point to the first character in the string
	MOV  CL, [BL]	; Copy the data from RAM into CL
Loop:
	MOV [AL], CL	; Copy the data in CL to the video RAM that AL points to
	INC  AL			; Make AL point to the next video RAM location
	INC  BL			; Make BL point to the next character in the string
	MOV  CL, [BL]	; Copy the data from RAM into CL
	CMP  CL,  00	; Check if the next character exists
	JNZ Loop
; --------------------------------------
	END
; --------------------------------------

For more examples, select File > Open Example.
`,or=`; --------------------------------------
;	Traffic Lights
; --------------------------------------
	MOV AL, 80		; 1000 0000
Loop:
	OUT 01			; Send data to traffic lights
	ROR AL			; Rotate the bits in AL to the right
	JMP Loop
; --------------------------------------
	END
; --------------------------------------

For more examples, select File > Open Example.
`,ir=`; --------------------------------------
;	Seven-segment Display
; --------------------------------------
	JMP Start		; Jump past the data table
	DB  FA			; 0 - 1111 1010
	DB  60			; 1 - 0110 0000
	DB  B6			; 2 - 1011 0110
	DB  9E			; 3 - 1001 1110
	DB  4E			; 4 - 0100 1110
	DB  DC			; 5 - 1101 1100
	DB  FC			; 6 - 1111 1100
	DB  8A			; 7 - 1000 1010
	DB  FE			; 8 - 1111 1110
	DB  DE			; 9 - 1101 1110
	DB  00
Start:
	MOV BL,  02		; Make BL point to the first entry in the data table
	MOV AL, [BL]	; Copy data from table to AL
Loop:
	OUT 02			; Send data to seven-segment display
	INC AL			; Set the right most bit to one
	NOP NOP NOP		; Wait for three cycles
	OUT 02			; Send data to seven-segment display
	INC BL			; Make BL point to the next entry in the data table
	MOV AL, [BL]	; Copy data from table to AL
	CMP AL,  00		; Check if the next entry exists
	JNZ Loop
	JMP Start
; --------------------------------------
	END
; --------------------------------------

For more examples, select File > Open Example.
`;const cr=/;\t(.*)/,cs=e=>cr.exec(e)[1],je={title:cs(kt),content:kt},ls=[tr,sr,nr,rr,ar,or,ir].map(e=>({title:cs(e),content:e})),lr=e=>Object.prototype.toString.call(e).slice(8,-1),Mt=e=>lr(e)==="Object",ds=(e,t)=>{const s={},r=Object.getOwnPropertyNames(t),a=Object.getOwnPropertySymbols(t),o=Mt(e);if(o){const h=Object.getOwnPropertyNames(e),g=Object.getOwnPropertySymbols(e),l=E=>{const C=typeof E=="symbol";(!C&&!r.includes(E)||C&&!a.includes(E))&&(s[E]=e[E])};h.forEach(l),g.forEach(l)}const c=h=>{const g=t[h],l=o&&Mt(g);s[h]=l?ds(e[h],g):g};return r.forEach(c),a.forEach(c),s},us=(e,...t)=>t.reduce((s,r)=>ds(s,r),e),P=(...e)=>{let t="";for(let s=0;s<e.length;s++){const r=e[s];if(r!=null)if(typeof r=="string")t.length>0&&(t+=" "),t+=r;else for(const a in r)r[a]===!0&&(t.length>0&&(t+=" "),t+=a)}return t},ee=e=>e>=128?e-255-1:e,hs=e=>e<0?e+255+1:e,ps=e=>e.toString(2).padStart(8,"0"),te=e=>e.toString(16).padStart(2,"0").toUpperCase(),dr=e=>ps(e).split("").map(Number),ur=(e,t,s)=>Math.min(Math.max(e,t),s),fs=e=>Number.parseInt(e,16),he=(e,t)=>(t===void 0&&(t=e,e=0),Array.from({length:t-e},(s,r)=>e+r)),hr=e=>e.split(/(?=[A-Z])/).join(" "),pr=/^\[(.*)\]$/,lt=e=>e.replace(pr,"$1"),fr=/\\/g,gr=e=>e.replace(fr,"\\\\"),mr=/'/g,Rr=e=>e.replace(mr,"\\'"),br=/'.*'/,vr=e=>{var s;const t=(s=br.exec(e))==null?void 0:s[0];return t===void 0?e:e.replace(t,`'${Rr(t.slice(1,-1))}'`)},Er=e=>e.split("").map(t=>t.charCodeAt(0)),Sr=(e,t)=>e.every((s,r)=>s===t[r]),dt=(e,t)=>{const s=[];for(let r=0;r<t.length;r+=e)s.push(t.slice(r,r+e));return s},_r=e=>e.map(t=>String.fromCharCode(t)),gs=()=>{},ut=e=>e(),wr=e=>t=>s=>e(s,t),xr=(e,t)=>{let s,r;return function a(...o){const c=Date.now();r!==void 0&&(window.clearTimeout(r),r=void 0),s===void 0||c-s>=t?(e(...o),s=c):r=window.setTimeout(()=>{a(...o),r=void 0},t-(c-s))}},Be=({name:e,message:t,stack:s})=>({name:e,message:t,stack:s});var ce=(e=>(e[e.Info=0]="Info",e[e.Warning=1]="Warning",e[e.Error=2]="Error",e))(ce||{});const yr={input:ls[4].content,breakpoints:[],activeRange:null,message:null},ht=de({name:"editor",initialState:yr,reducers:{setInput:{reducer:(e,t)=>{e.input=t.payload.value},prepare:({value:e,isFromFile:t=!1})=>({payload:{value:e,isFromFile:t}})},setBreakpoints:(e,t)=>{e.breakpoints=t.payload},addBreakpoint:(e,t)=>{const s=t.payload,r=e.breakpoints.findIndex(a=>a.from>s.from);r===-1?e.breakpoints.push(s):e.breakpoints.splice(r,0,s)},removeBreakpoint:(e,t)=>{const s=t.payload,r=e.breakpoints.findIndex(a=>is(a,s));e.breakpoints.splice(r,1)},setActiveRange:(e,t)=>{const s=t.payload;e.activeRange=s.range},clearActiveRange:e=>{e.activeRange=null},setMessage:(e,t)=>{e.message=t.payload},clearMessage:e=>{e.message=null}}}),we=e=>e.editor.input,pt=e=>e.editor.breakpoints,Nr=e=>e.editor.activeRange,Ir=wr(Z([Nr,(e,t)=>t],(e,t)=>{if(e===null)return;const s=[];for(let r=e.from;r<e.to;r++)if(r<t.state.doc.length){const a=t.state.doc.lineAt(r);s.includes(a.from)||s.push(a.from)}return s.length>0?s:void 0})),Tt=e=>e.editor.message,Cr=Z(we,pt,(e,t)=>({input:e,breakpoints:t})),{setInput:Y,setBreakpoints:ms,addBreakpoint:Lr,removeBreakpoint:Dr,setActiveRange:Rs,clearActiveRange:Ee,setMessage:Ke,clearMessage:Ot}=ht.actions;var Ar=ht.reducer;const Gt={source:"",addressToStatementMap:{},error:null},bs=de({name:"assembler",initialState:Gt,reducers:{setState:(e,t)=>{e.source=t.payload.source,e.addressToStatementMap=t.payload.addressToStatementMap,e.error=null},setError:(e,t)=>{e.source="",e.addressToStatementMap={},e.error=t.payload},clearError:e=>{e.error=null},resetState:()=>Gt}}),kr=e=>e.assembler.source,vs=e=>e.assembler.addressToStatementMap,Es=e=>e.assembler.error,Mr=e=>{var t;return(t=e.assembler.error)==null?void 0:t.range},{setState:Ss,setError:Tr,clearError:Or,resetState:Gr}=bs.actions;var Br=bs.reducer,Xe=(e=>(e[e["2 Hz"]=2]="2 Hz",e[e["4 Hz"]=4]="4 Hz",e[e["8 Hz"]=8]="8 Hz",e[e["16 Hz"]=16]="16 Hz",e[e["32 Hz"]=32]="32 Hz",e[e["64 Hz"]=64]="64 Hz",e))(Xe||{});const Pr=["2 Hz","4 Hz","8 Hz","16 Hz","32 Hz","64 Hz"];var Ze=(e=>(e[e["1 second"]=1e3]="1 second",e[e["2 seconds"]=2e3]="2 seconds",e[e["4 seconds"]=4e3]="4 seconds",e[e["8 seconds"]=8e3]="8 seconds",e))(Ze||{});const Ur=["1 second","2 seconds","4 seconds","8 seconds"],Fr={configuration:{autoAssemble:!0,clockSpeed:4,timerInterval:2e3},isRunning:!1,isSuspended:!1},ft=de({name:"controller",initialState:Fr,reducers:{setAutoAssemble:(e,t)=>{e.configuration.autoAssemble=t.payload},setClockSpeed:(e,t)=>{e.configuration.clockSpeed=t.payload},setTimerInterval:(e,t)=>{e.configuration.timerInterval=t.payload},setRunning:(e,t)=>{e.isRunning=t.payload},setSuspended:(e,t)=>{e.isSuspended=t.payload}}}),Vr=e=>e.controller.configuration,Ye=e=>e.controller.configuration.autoAssemble,_s=e=>e.controller.configuration.clockSpeed,ws=e=>e.controller.configuration.timerInterval,qe=Z(_s,ws,(e,t)=>({clockSpeed:e,timerInterval:t})),Se=e=>e.controller.isRunning,pe=e=>e.controller.isSuspended,Hr=Z(Vr,e=>({configuration:e})),{setAutoAssemble:xs,setClockSpeed:Wr,setTimerInterval:Jr,setRunning:Bt,setSuspended:Ce}=ft.actions;var zr=ft.reducer;const ue="\xA0",Me=250;var Re=(e=>(e[e.BS=8]="BS",e[e.TAB=9]="TAB",e[e.CR=13]="CR",e[e.Space=32]="Space",e))(Re||{}),w=(e=>(e.END="END",e.ADD="ADD",e.SUB="SUB",e.MUL="MUL",e.DIV="DIV",e.INC="INC",e.DEC="DEC",e.MOD="MOD",e.AND="AND",e.OR="OR",e.XOR="XOR",e.NOT="NOT",e.ROL="ROL",e.ROR="ROR",e.SHL="SHL",e.SHR="SHR",e.JMP="JMP",e.JZ="JZ",e.JNZ="JNZ",e.JS="JS",e.JNS="JNS",e.JO="JO",e.JNO="JNO",e.MOV="MOV",e.CMP="CMP",e.PUSH="PUSH",e.POP="POP",e.PUSHF="PUSHF",e.POPF="POPF",e.CALL="CALL",e.RET="RET",e.INT="INT",e.IRET="IRET",e.IN="IN",e.OUT="OUT",e.HALT="HALT",e.STI="STI",e.CLI="CLI",e.CLO="CLO",e.NOP="NOP",e.ORG="ORG",e.DB="DB",e))(w||{});const ys={END:0,ADD:2,SUB:2,MUL:2,DIV:2,INC:1,DEC:1,MOD:2,AND:2,OR:2,XOR:2,NOT:1,ROL:1,ROR:1,SHL:1,SHR:1,JMP:1,JZ:1,JNZ:1,JS:1,JNS:1,JO:1,JNO:1,MOV:2,CMP:2,PUSH:1,POP:1,PUSHF:0,POPF:0,CALL:1,RET:0,INT:1,IRET:0,IN:1,OUT:1,HALT:0,STI:0,CLI:0,CLO:0,NOP:0,ORG:1,DB:1};var p=(e=>(e[e.END=0]="END",e[e.ADD_REG_TO_REG=160]="ADD_REG_TO_REG",e[e.SUB_REG_FROM_REG=161]="SUB_REG_FROM_REG",e[e.MUL_REG_BY_REG=162]="MUL_REG_BY_REG",e[e.DIV_REG_BY_REG=163]="DIV_REG_BY_REG",e[e.INC_REG=164]="INC_REG",e[e.DEC_REG=165]="DEC_REG",e[e.MOD_REG_BY_REG=166]="MOD_REG_BY_REG",e[e.AND_REG_WITH_REG=170]="AND_REG_WITH_REG",e[e.OR_REG_WITH_REG=171]="OR_REG_WITH_REG",e[e.XOR_REG_WITH_REG=172]="XOR_REG_WITH_REG",e[e.NOT_REG=173]="NOT_REG",e[e.ROL_REG=154]="ROL_REG",e[e.ROR_REG=155]="ROR_REG",e[e.SHL_REG=156]="SHL_REG",e[e.SHR_REG=157]="SHR_REG",e[e.ADD_NUM_TO_REG=176]="ADD_NUM_TO_REG",e[e.SUB_NUM_FROM_REG=177]="SUB_NUM_FROM_REG",e[e.MUL_REG_BY_NUM=178]="MUL_REG_BY_NUM",e[e.DIV_REG_BY_NUM=179]="DIV_REG_BY_NUM",e[e.MOD_REG_BY_NUM=182]="MOD_REG_BY_NUM",e[e.AND_REG_WITH_NUM=186]="AND_REG_WITH_NUM",e[e.OR_REG_WITH_NUM=187]="OR_REG_WITH_NUM",e[e.XOR_REG_WITH_NUM=188]="XOR_REG_WITH_NUM",e[e.JMP=192]="JMP",e[e.JZ=193]="JZ",e[e.JNZ=194]="JNZ",e[e.JS=195]="JS",e[e.JNS=196]="JNS",e[e.JO=197]="JO",e[e.JNO=198]="JNO",e[e.MOV_NUM_TO_REG=208]="MOV_NUM_TO_REG",e[e.MOV_ADDR_TO_REG=209]="MOV_ADDR_TO_REG",e[e.MOV_REG_TO_ADDR=210]="MOV_REG_TO_ADDR",e[e.MOV_REG_ADDR_TO_REG=211]="MOV_REG_ADDR_TO_REG",e[e.MOV_REG_TO_REG_ADDR=212]="MOV_REG_TO_REG_ADDR",e[e.CMP_REG_WITH_REG=218]="CMP_REG_WITH_REG",e[e.CMP_REG_WITH_NUM=219]="CMP_REG_WITH_NUM",e[e.CMP_REG_WITH_ADDR=220]="CMP_REG_WITH_ADDR",e[e.PUSH_FROM_REG=224]="PUSH_FROM_REG",e[e.POP_TO_REG=225]="POP_TO_REG",e[e.PUSHF=234]="PUSHF",e[e.POPF=235]="POPF",e[e.CALL_ADDR=202]="CALL_ADDR",e[e.RET=203]="RET",e[e.INT_ADDR=204]="INT_ADDR",e[e.IRET=205]="IRET",e[e.IN_FROM_PORT_TO_AL=240]="IN_FROM_PORT_TO_AL",e[e.OUT_FROM_AL_TO_PORT=241]="OUT_FROM_AL_TO_PORT",e[e.HALT=0]="HALT",e[e.STI=252]="STI",e[e.CLI=253]="CLI",e[e.CLO=254]="CLO",e[e.NOP=255]="NOP",e))(p||{});const Ns=256,xe=192,Is=()=>new Array(Ns-xe).fill(Re.Space),Cs=()=>new Array(xe).fill(0).concat(Is()),$r=e=>{const t=Cs();for(const s in e)t[s]=e[s];return t},jr=e=>e.slice(xe),Kr=e=>{const t=Array.from({length:Ns},(s,r)=>r<xe?w.END:"");for(const s in e){const r=Number(s),a=e[s],{instruction:o,operands:c}=a;if(o.mnemonic===w.DB){const h=c[0];typeof h.value=="number"?t[s]=h.rawValue:h.rawValue.split("").forEach((g,l)=>{t[r+l]=g})}else{t[s]=o.mnemonic;const h=r+1;c.forEach((g,l)=>{const{rawValue:E}=g;t[h+l]=g.type.endsWith("Address")?`[${E}]`:E})}}return t};var Te=(e=>(e.Hexadecimal="Hexadecimal",e.Decimal="Decimal",e.Source="Source",e))(Te||{});const Xr=Object.values(Te),Ls=Cs(),Zr={data:Ls,view:"Hexadecimal"},Ds=de({name:"memory",initialState:Zr,reducers:{setData:(e,t)=>{e.data=t.payload},setDataFrom:(e,t)=>{e.data=$r(t.payload)},resetData:e=>{e.data=Ls},setView:(e,t)=>{e.view=t.payload}}}),gt=e=>e.memory.data,Yr=Z(gt,e=>()=>dt(16,e)),qr=Z(vs,e=>()=>{const t=Kr(e);return dt(16,t)}),As=e=>e.memory.view,{setData:Qr,setDataFrom:ks,resetData:ea,setView:ta}=Ds.actions;var sa=Ds.reducer;const mt=191;var se=(e=>(e[e.AL=0]="AL",e[e.BL=1]="BL",e[e.CL=2]="CL",e[e.DL=3]="DL",e))(se||{}),Le=(e=>(e.IP="IP",e.SP="SP",e.SR="SR",e))(Le||{});class q extends Error{constructor(){super(...arguments);k(this,"name","RuntimeError")}toPlainObject(){return{name:this.name,message:this.message}}}class na extends q{constructor(t){super(`Invalid register '${te(t)}'.`)}}class ra extends q{constructor(){super("Can not execute code beyond the end of RAM.")}}class aa extends q{constructor(){super("Stack overflow.")}}class oa extends q{constructor(){super("Stack underflow.")}}class ia extends q{constructor(){super("Can not divide by zero.")}}class ca extends q{constructor(t){super(`I/O ports between 0 and F are available, got '${te(t)}'.`)}}class la extends q{constructor(t){super(`Input data '${te(t)}' is greater than FF.`)}}class da extends q{constructor(t){super(`Invalid opcode '${te(t)}'.`)}}const Qe=(e,t)=>t+e,et=(e,t)=>t-e,Pt=(e,t)=>t*e,Ms=e=>{if(e===0)throw new ia;return e},tt=(e,t)=>Math.floor(t/Ms(e)),ua=e=>Qe(1,e),ha=e=>et(1,e),st=(e,t)=>t%Ms(e),Ut=(e,t)=>t&e,Ft=(e,t)=>t|e,Vt=(e,t)=>t^e,pa=e=>~e,fa=e=>{const t=tt(128,e);return(e<<1)+t},ga=e=>st(2,e)*128+(e>>1),ma=e=>e<<1,Ra=e=>e>>1,Ts=-1,ba=15;var Rt=(e=>(e[e.SimulatedKeyboard=0]="SimulatedKeyboard",e[e.Thermostat=3]="Thermostat",e[e.Keyboard=7]="Keyboard",e[e.NumericKeypad=8]="NumericKeypad",e))(Rt||{});const va={data:{content:null,port:null},interrupt:!1};var nt=(e=>(e[e.TrafficLights=1]="TrafficLights",e[e.SevenSegmentDisplay=2]="SevenSegmentDisplay",e[e.Heater=3]="Heater",e[e.SnakeInMaze=4]="SnakeInMaze",e[e.StepperMotor=5]="StepperMotor",e[e.Lift=6]="Lift",e[e.Keyboard=7]="Keyboard",e[e.NumericKeypad=8]="NumericKeypad",e))(nt||{});const Ea=2;var Os=(e=>(e[e.Zero=0]="Zero",e[e.Overflow=1]="Overflow",e[e.Sign=2]="Sign",e[e.Interrupt=3]="Interrupt",e))(Os||{});const Sa=()=>({gpr:[0,0,0,0],ip:0,sp:mt,sr:[0,0,0,0]}),_=e=>{if(e<se.AL||e>se.DL)throw new na(e);return e},_a=e=>{if(e>255)throw new ra;return e},Ht=e=>{if(e<0)throw new aa;if(e>mt)throw new oa;return e},De=e=>e.reduce((t,s,r)=>t+s*2**(r+1),0),Gs=(e,t)=>e[t]===1,wa=e=>e.toString(2).padStart(5,"0").slice(-5,-1).split("").map(Number).reverse(),Ne=(e,t)=>{const s=[0,0,0];(t<128&&e>=128||t>=128&&e<128)&&(s[1]=1);const r=e>255?e%256:hs(e);return r===0?s[0]=1:r>=128&&(s[2]=1),[r,s]},Wt=e=>{if(e<0||e>ba)throw new ca(e);return e},xa=e=>{if(e>255)throw new la(e);return e},ya=(e,t)=>{const s=()=>t.data,r=()=>t.interrupt,a={},o=()=>{a.halted=!0},c=b=>{a.requiredInputPort=b},h=(b,m)=>{a.data={content:b,port:m}},g=()=>{a.closeWindows=!0},l={input:t,output:a},E={cpuRegisters:{}},C=b=>{E.memoryData=b},N=(b,m)=>{E.cpuRegisters[b]=m},L=as(e,({memoryData:b,cpuRegisters:m})=>{const f=i=>b[i],j=(i,v)=>{b[i]=v,C({address:i,value:v})},S=i=>m.gpr[i],y=(i,v)=>{m.gpr[i]=v,N("gpr",{name:se[i],value:v})},ne=()=>m.ip,O=(i=1)=>m.ip+i,V=i=>{m.ip=i,N("ip",{value:i})},d=(i=1)=>(V(_a(m.ip+i)),m.ip),H=i=>{j(m.sp,i);const v=Ht(m.sp-1);m.sp=v,N("sp",{value:v})},K=()=>{const i=Ht(m.sp+1);return m.sp=i,N("sp",{value:i}),f(m.sp)},re=()=>m.sr,J=i=>{Object.assign(m.sr,i),N("sr",{value:De(m.sr)})},W=i=>Gs(m.sr,i),ge=i=>{m.sr[3]=i,N("sr",{interrupt:!0,value:De(m.sr)})},x=(i,...v)=>{const[oe,hn]=Ne(i(...v),v[v.length-1]);return J(hn),oe},U=r()&&W(3),ae=U?p.INT_ADDR:f(ne());switch(ae){case p.END:case p.HALT:o();break;case p.ADD_REG_TO_REG:{const i=_(f(d())),v=_(f(d()));y(i,x(Qe,S(v),S(i))),d();break}case p.SUB_REG_FROM_REG:{const i=_(f(d())),v=_(f(d()));y(i,x(et,S(v),S(i))),d();break}case p.MUL_REG_BY_REG:{const i=_(f(d())),v=_(f(d()));y(i,x(Pt,S(v),S(i))),d();break}case p.DIV_REG_BY_REG:{const i=_(f(d())),v=_(f(d()));y(i,x(tt,S(v),S(i))),d();break}case p.INC_REG:{const i=_(f(d()));y(i,x(ua,S(i))),d();break}case p.DEC_REG:{const i=_(f(d()));y(i,x(ha,S(i))),d();break}case p.MOD_REG_BY_REG:{const i=_(f(d())),v=_(f(d()));y(i,x(st,S(v),S(i))),d();break}case p.AND_REG_WITH_REG:{const i=_(f(d())),v=_(f(d()));y(i,x(Ut,S(v),S(i))),d();break}case p.OR_REG_WITH_REG:{const i=_(f(d())),v=_(f(d()));y(i,x(Ft,S(v),S(i))),d();break}case p.XOR_REG_WITH_REG:{const i=_(f(d())),v=_(f(d()));y(i,x(Vt,S(v),S(i))),d();break}case p.NOT_REG:{const i=_(f(d()));y(i,x(pa,S(i))),d();break}case p.ROL_REG:{const i=_(f(d()));y(i,x(fa,S(i))),d();break}case p.ROR_REG:{const i=_(f(d()));y(i,x(ga,S(i))),d();break}case p.SHL_REG:{const i=_(f(d()));y(i,x(ma,S(i))),d();break}case p.SHR_REG:{const i=_(f(d()));y(i,x(Ra,S(i))),d();break}case p.ADD_NUM_TO_REG:{const i=_(f(d())),v=f(d());y(i,x(Qe,v,S(i))),d();break}case p.SUB_NUM_FROM_REG:{const i=_(f(d())),v=f(d());y(i,x(et,v,S(i))),d();break}case p.MUL_REG_BY_NUM:{const i=_(f(d())),v=f(d());y(i,x(Pt,v,S(i))),d();break}case p.DIV_REG_BY_NUM:{const i=_(f(d())),v=f(d());y(i,x(tt,v,S(i))),d();break}case p.MOD_REG_BY_NUM:{const i=_(f(d())),v=f(d());y(i,x(st,v,S(i))),d();break}case p.AND_REG_WITH_NUM:{const i=_(f(d())),v=f(d());y(i,x(Ut,v,S(i))),d();break}case p.OR_REG_WITH_NUM:{const i=_(f(d())),v=f(d());y(i,x(Ft,v,S(i))),d();break}case p.XOR_REG_WITH_NUM:{const i=_(f(d())),v=f(d());y(i,x(Vt,v,S(i))),d();break}case p.JMP:{const i=ee(f(O()));d(i);break}case p.JZ:{const i=ee(f(O()));d(W(0)?i:2);break}case p.JNZ:{const i=ee(f(O()));d(W(0)?2:i);break}case p.JS:{const i=ee(f(O()));d(W(2)?i:2);break}case p.JNS:{const i=ee(f(O()));d(W(2)?2:i);break}case p.JO:{const i=ee(f(O()));d(W(1)?i:2);break}case p.JNO:{const i=ee(f(O()));d(W(1)?2:i);break}case p.MOV_NUM_TO_REG:{const i=_(f(d())),v=f(d());y(i,v),d();break}case p.MOV_ADDR_TO_REG:{const i=_(f(d())),v=f(d());y(i,f(v)),d();break}case p.MOV_REG_TO_ADDR:{const i=f(d()),v=_(f(d()));j(i,S(v)),d();break}case p.MOV_REG_ADDR_TO_REG:{const i=_(f(d())),v=_(f(d()));y(i,f(S(v))),d();break}case p.MOV_REG_TO_REG_ADDR:{const i=_(f(d())),v=_(f(d()));j(S(i),S(v)),d();break}case p.CMP_REG_WITH_REG:{const i=_(f(d())),v=_(f(d())),[,oe]=Ne(S(i)-S(v),S(i));J(oe),d();break}case p.CMP_REG_WITH_NUM:{const i=_(f(d())),v=f(d()),[,oe]=Ne(S(i)-v,S(i));J(oe),d();break}case p.CMP_REG_WITH_ADDR:{const i=_(f(d())),v=f(d()),[,oe]=Ne(S(i)-f(v),S(i));J(oe),d();break}case p.PUSH_FROM_REG:{const i=_(f(d()));H(S(i)),d();break}case p.POP_TO_REG:{const i=_(f(d()));y(i,K()),d();break}case p.PUSHF:{H(De(re())),d();break}case p.POPF:{const i=wa(K());J(i),d();break}case p.CALL_ADDR:{const i=f(O());H(O(2)),V(i);break}case p.RET:{V(K());break}case p.INT_ADDR:{if(U){H(ne()),V(f(Ea));break}const i=f(O());H(O(2)),V(f(i));break}case p.IRET:{V(K());break}case p.IN_FROM_PORT_TO_AL:{const i=s(),v=Wt(f(O()));if(i.content===null||i.port!==v){c(v);break}i.content!==Ts&&y(se.AL,xa(i.content)),d(2);break}case p.OUT_FROM_AL_TO_PORT:{const i=S(se.AL),v=Wt(f(d()));h(i,v),d();break}case p.STI:{ge(1),d();break}case p.CLI:{ge(0),d();break}case p.CLO:{g(),d();break}case p.NOP:{d();break}default:throw new da(ae)}});return M(A({},L),{signals:l,changes:E})},Jt={status:{fault:null,halted:!1},registers:Sa()},Bs=de({name:"cpu",initialState:Jt,reducers:{setFault:(e,t)=>{e.status.fault=t.payload},setHalted:e=>{e.status.halted=!0},setRegisters:(e,t)=>{e.registers=t.payload},resetState:()=>Jt}}),Na=e=>e.cpu.status,Ia=e=>e.cpu.status.fault,Ca=e=>e.cpu.registers,La=e=>e.cpu.registers.gpr,Da=e=>e.cpu.registers.ip,Aa=e=>e.cpu.registers.sp,Ps=Z(Da,Aa,(e,t)=>({ip:e,sp:t})),ka=e=>e.cpu.registers.sr,Ma=Z(ka,De),{setFault:Ta,setHalted:rt,setRegisters:Oa,resetState:bt}=Bs.actions;var Ga=Bs.reducer,le=(e=>(e.VisualDisplayUnit="VisualDisplayUnit",e.TrafficLights="TrafficLights",e.SevenSegmentDisplay="Seven-segmentDisplay",e))(le||{});const Us=Object.values(le),Ba=Is(),zt=new Array(8).fill(0),$t={inputSignals:va,isWaitingForInput:!1,isWaitingForKeyboardInput:!1,devices:{VisualDisplayUnit:{data:Ba,isVisible:!0},TrafficLights:{data:zt,isVisible:!1},["Seven-segmentDisplay"]:{data:zt,isVisible:!1}}},Fs=de({name:"io",initialState:$t,reducers:{setInputData:(e,t)=>{const{content:s,port:r}=t.payload;e.inputSignals.data.content=s,e.inputSignals.data.port=r},clearInputData:e=>{e.inputSignals.data.content=null,e.inputSignals.data.port=null},setInterrupt:(e,t)=>{e.inputSignals.interrupt=t.payload},setWaitingForInput:(e,t)=>{e.isWaitingForInput=t.payload},setWaitingForKeyboardInput:(e,t)=>{e.isWaitingForKeyboardInput=t.payload},setVduDataFrom:(e,t)=>{const s=t.payload;e.devices.VisualDisplayUnit.data=jr(s)},setDeviceData:(e,t)=>{const{name:s,data:r}=t.payload;e.devices[s].data=dr(r)},toggleDeviceVisible:(e,t)=>{const s=t.payload;e.devices[s].isVisible=!e.devices[s].isVisible},setDevicesInvisible:e=>{Us.forEach(t=>{e.devices[t].isVisible=!1})},resetState:e=>us($t,{devices:Object.entries(e.devices).reduce((t,[s,{isVisible:r}])=>Object.assign(t,{[s]:{isVisible:r}}),{})})}}),Pa=e=>e.io.inputSignals,Ua=e=>e.io.isWaitingForInput,Fa=e=>e.io.isWaitingForKeyboardInput,Va=e=>e.io.devices,Ha=e=>t=>t.io.devices[e].data,Wa=e=>t=>t.io.devices[e].isVisible,{setInputData:Ja,clearInputData:jt,setInterrupt:Kt,setWaitingForInput:Xt,setWaitingForKeyboardInput:Vs,setVduDataFrom:Hs,setDeviceData:Ws,toggleDeviceVisible:Js,setDevicesInvisible:za,resetState:zs}=Fs.actions;var $a=Fs.reducer;const ja=null,$s=de({name:"exception",initialState:ja,reducers:{set:(e,t)=>t.payload,clear:()=>null}}),Ka=e=>e.exception,{set:vt,clear:Xa}=$s.actions;var Za=$s.reducer;const Ya=()=>{const e=new Map,t=s=>r=>a=>{var c;const o=r(a);return(c=e.get(a.type))==null||c.forEach(h=>h(a.payload,s)),o};return t.listenAction=(s,r,{once:a=!1}={})=>{const o=bn(s);e.has(o)||e.set(o,new Set);const c=e.get(o),h=a?(l,E)=>(g(),r(l,E)):r;c.add(h);const g=()=>{c.delete(h)&&c.size===0&&e.delete(o)};return g},t},js=Ya(),{listenAction:F}=js,Zt=Symbol("nil"),qa=()=>{const e=new Map;let t=!1,s=0;const r=a=>o=>c=>{if(t){const g=a.getState();e.forEach((l,E)=>{l.prevSelected===Zt&&(l.prevSelected=E(g))}),t=!1}s+=1;const h=o(c);if(s===1){const g=a.getState();e.forEach((l,E)=>{const{prevSelected:C,callbacks:N}=l,L=E(g);L!==C&&(N.forEach(b=>b(L,a)),l.prevSelected=L)})}return s-=1,h};return r.watch=(a,o)=>{e.has(a)||(e.set(a,{prevSelected:Zt,callbacks:new Set}),t=!0);const{callbacks:c}=e.get(a);return c.add(o),()=>{c.delete(o)&&c.size===0&&e.delete(a)}},r},Ks=qa(),{watch:Pe}=Ks,Qa="assembler-simulator",Xs=`persist:${Qa}`,eo=()=>{try{const e=localStorage.getItem(Xs);return JSON.parse(e!=null?e:"{}")}catch{return{}}},to=()=>{const e=eo();return us({editor:ht.getInitialState(),controller:ft.getInitialState()},e)},so=e=>{try{const t=JSON.stringify(e);localStorage.setItem(Xs,t)}catch{}},no=vn({editor:Ar,assembler:Br,controller:zr,memory:sa,cpu:Ga,io:$a,exception:Za}),ro=En({reducer:no,middleware:e=>e().prepend(Ks,js),preloadedState:to()}),Et=e=>R.exports.useReducer(t=>!t,e),Yt=Symbol("nil"),Zs=e=>{const t=R.exports.useRef(Yt);return t.current===Yt&&(t.current=e instanceof Function?e():e),t.current},_e=()=>{const[e,t]=R.exports.useState(null),s=R.exports.useCallback(r=>{t(r)},[]);return[e,s]},St=e=>{const[t,s]=_e();return R.exports.useEffect(()=>{if(t===null)return;const r=a=>{const{target:o}=a;o instanceof Node&&!t.contains(o)&&e(a)};return document.addEventListener("click",r),()=>{document.removeEventListener("click",r)}},[t,e]),s},Ys=e=>{const[t,s]=_e(),[r,a]=R.exports.useState(!1),o=R.exports.useRef();return R.exports.useEffect(()=>{if(t===null)return;const c=()=>{e===void 0?a(!0):o.current=window.setTimeout(()=>{a(!0),o.current=void 0},e)},h=()=>{a(!1),o.current!==void 0&&(window.clearTimeout(o.current),o.current=void 0)};return t.addEventListener("mouseenter",c),t.addEventListener("mouseleave",h),()=>{a(!1),t.removeEventListener("mouseenter",c),t.removeEventListener("mouseleave",h)}},[t,e]),[r,s]},qs=R.exports.createContext({currentOpen:null,setCurrentOpen:gs}),Ue=({children:e})=>{const[t,s]=_e(),r=t!==null,{currentOpen:a,setCurrentOpen:o}=R.exports.useContext(qs),c=a!==null&&a===t,h=()=>{o(c?null:t)},[g,l]=Ys();return R.exports.useEffect(()=>{a!==null&&a!==t&&g&&o(t)},[a,t,g]),n("div",{ref:s,className:P("flex items-center hover:bg-gray-200",{"bg-gray-200":c}),onClick:h,children:r&&e(c,l,t)})},Qs="flex space-x-2 items-center",ao=({children:e})=>n("div",{className:Qs,children:e}),oo=({children:e,innerRef:t})=>n("div",{ref:t,className:P(Qs,"py-1 px-2"),children:e});var D=Object.assign(ao,{Main:oo});const en="divide-y border bg-gray-50 shadow fixed",io=({menuElement:e,children:t})=>n("div",{ref:r=>{if(r===null)return;const{bottom:a,left:o}=e.getBoundingClientRect();r.style.top=`${a-1}px`,r.style.left=`${o}px`},className:en,children:t}),co=({innerRef:e,menuItemElement:t,children:s})=>n("div",{ref:a=>{if(e(a),a===null)return;const{top:o,right:c}=t.getBoundingClientRect(),h=t.offsetTop===0;a.style.top=`${o-(h?1:0)}px`,a.style.left=`${c}px`},className:en,children:s});var Q=Object.assign(io,{Expanded:co});const ye=e=>n("svg",M(A({className:"w-4",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},e),{children:n("path",{d:"M20.285 2l-11.285 11.567-5.286-5.011-3.714 3.716 9 8.728 15-15.285z"})})),lo=e=>n("svg",M(A({className:"w-4",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},e),{children:n("path",{d:"M15.602 4.075c2.201 1.174 4.904 3.254 6.398 5.252-1.286-.9-3.011-1.027-5.058-.549.222-1.469-.185-3.535-1.34-4.703zm-.825 6.925s1.522-7-3.335-7h-5.442v20h16v-10.629c0-3.42-4.214-3.116-7.223-2.371zm-.777-9l-3-2h-9v22h2v-20h10z"})})),uo=e=>n("svg",M(A({className:"w-4",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},e),{children:n("path",{d:"M1.004 6.251l10.996-5.998 10.99 6.06-10.985 5.861-11.001-5.923zm11.996 7.676v9.82l10-5.362v-9.82l-10 5.362zm-2 0l-10-5.411v9.869l10 5.362v-9.82z"})})),ho=e=>n("svg",M(A({className:"w-4",viewBox:"0 0 512 512",xmlns:"http://www.w3.org/2000/svg"},e),{children:n("path",{d:"M507.73 109.1c-2.24-9.03-13.54-12.09-20.12-5.51l-74.36 74.36-67.88-11.31-11.31-67.88 74.36-74.36c6.62-6.62 3.43-17.9-5.66-20.16-47.38-11.74-99.55.91-136.58 37.93-39.64 39.64-50.55 97.1-34.05 147.2L18.74 402.76c-24.99 24.99-24.99 65.51 0 90.5 24.99 24.99 65.51 24.99 90.5 0l213.21-213.21c50.12 16.71 107.47 5.68 147.37-34.22 37.07-37.07 49.7-89.32 37.91-136.73zM64 472c-13.25 0-24-10.75-24-24 0-13.26 10.75-24 24-24s24 10.74 24 24c0 13.25-10.75 24-24 24z"})})),po=e=>n("svg",M(A({className:"w-4",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},e),{children:n("path",{d:"M13 7v-6l11 11-11 11v-6h-13v-10z"})})),tn=e=>n("svg",M(A({className:"w-4",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},e),{children:n("path",{d:"M3 22v-20l18 10-18 10z"})})),fo=e=>n("svg",M(A({className:"w-4",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},e),{children:n("path",{d:"M2 2h20v20h-20z"})})),go=e=>n("svg",M(A({className:"w-4",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},e),{children:n("path",{d:"M14 12l-14 9v-18l14 9zm-4-9v4l8.022 5-8.022 5v4l14-9-14-9z"})})),mo=e=>u("svg",M(A({className:"w-4",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},e),{children:[n("path",{d:"M17.026 22.957c10.957-11.421-2.326-20.865-10.384-13.309l2.464 2.352h-9.106v-8.947l2.232 2.229c14.794-13.203 31.51 7.051 14.794 17.675z"})," "]})),Ro=e=>n("svg",M(A({className:"w-4",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},e),{children:n("path",{d:"M14.601 21.5c0 1.38-1.116 2.5-2.499 2.5-1.378 0-2.499-1.12-2.499-2.5s1.121-2.5 2.499-2.5c1.383 0 2.499 1.119 2.499 2.5zm-2.42-21.5c-4.029 0-7.06 2.693-7.06 8h3.955c0-2.304.906-4.189 3.024-4.189 1.247 0 2.57.828 2.684 2.411.123 1.666-.767 2.511-1.892 3.582-2.924 2.78-2.816 4.049-2.816 7.196h3.943c0-1.452-.157-2.508 1.838-4.659 1.331-1.436 2.986-3.222 3.021-5.943.047-3.963-2.751-6.398-6.697-6.398z"})})),bo=e=>n("svg",M(A({className:"w-4",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},e),{children:n("path",{d:"M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"})})),vo=e=>n("svg",M(A({className:"w-4",viewBox:"0 0 480 512",xmlns:"http://www.w3.org/2000/svg"},e),{children:n("path",{d:"M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"})})),sn=e=>n("svg",M(A({className:"w-4",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},e),{children:n("path",{d:"M0 16.67l2.829 2.83 9.175-9.339 9.167 9.339 2.829-2.83-11.996-12.17z"})})),nn=e=>n("svg",M(A({className:"w-4",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},e),{children:n("path",{d:"M0 7.33l2.829-2.83 9.175 9.339 9.167-9.339 2.829 2.83-11.996 12.17z"})})),Eo=e=>u("svg",M(A({className:"w-4",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},e),{children:[n("path",{d:"M23.954 21.03l-9.184-9.095 9.092-9.174-2.832-2.807-9.09 9.179-9.176-9.088-2.81 2.81 9.186 9.105-9.095 9.184 2.81 2.81 9.112-9.192 9.18 9.1z"})," "]})),So=e=>u("svg",M(A({className:"w-4",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},e),{children:[n("path",{clipRule:"evenodd",d:"M12 19C15.866 19 19 15.866 19 12C19 8.13401 15.866 5 12 5C8.13401 5 5 8.13401 5 12C5 15.866 8.13401 19 12 19ZM12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22Z",fill:"currentColor",fillRule:"evenodd",opacity:"0.2"}),n("path",{d:"M2 12C2 6.47715 6.47715 2 12 2V5C8.13401 5 5 8.13401 5 12H2Z",fill:"currentColor"})]})),_t="flex space-x-4 py-1 px-2 items-center justify-between hover:bg-gray-200",_o=({onClick:e,children:t})=>u("div",{className:_t,onClick:e,children:[t,n("span",{className:"w-4"})]}),wo=({href:e,children:t})=>u("div",{className:_t,onClick:()=>{window.open(e,"_blank","noreferrer")},children:[t,n("div",{className:"w-4",children:n(bo,{className:"mx-auto fill-gray-400 w-3.5"})})]}),xo=({children:e})=>{const[t,s]=_e(),r=t!==null,[a,o]=Ys(100),c=E=>{s(E),o(E)},[h,g]=_e();return n("div",{ref:c,className:_t,onClick:E=>{h!==null&&!h.contains(E.target)&&E.stopPropagation()},children:r&&u(G,{children:[n("div",{children:e(a,g,t)}),n("div",{className:"w-4",children:n(tn,{className:"mx-auto w-2.5"})})]})})};var B=Object.assign(_o,{ExternalLink:wo,Expandable:xo});const T=Sn,I=_n,yo=()=>{const e=T();return n(B,{onClick:()=>{e.dispatch(Y({value:je.content,isFromFile:!0}))},children:u(D,{children:[n("span",{className:"w-4"}),n("span",{children:"New File"})]})})},No=({onFileLoad:e})=>{const t=R.exports.useRef(null),s=h=>{h.stopPropagation(),t.current.click()},r=h=>{h.stopPropagation()},a=T(),o=h=>{const g=new FileReader;g.onload=function(){const l=this.result;a.dispatch(Y({value:l,isFromFile:!0}))},g.readAsText(h)};return u(B,{onClick:s,children:[u(D,{children:[n("span",{className:"w-4"}),n("span",{children:"Open..."})]}),n("input",{ref:t,className:"hidden",type:"file",onChange:({target:h})=>{const g=h.files[0];o(g),e()},onClick:r})]})},Io=()=>{const e=T();return n(B.Expandable,{children:(t,s,r)=>u(G,{children:[u(D,{children:[n("span",{className:"w-4"}),n("span",{children:"Open Example"})]}),t&&n(Q.Expanded,{innerRef:s,menuItemElement:r,children:ls.map(({title:a,content:o},c)=>n(B,{onClick:()=>{e.dispatch(Y({value:o,isFromFile:!0}))},children:u(D,{children:[n("span",{className:"w-4"}),n("span",{children:a})]})},c))})]})})},Co=()=>{const e=T();return n(B,{onClick:()=>{const s=we(e.getState()),r=new Blob([s],{type:"application/octet-stream"}),a=URL.createObjectURL(r);Object.assign(document.createElement("a"),{download:"file.asm",href:a}).click(),URL.revokeObjectURL(a)},children:u(D,{children:[n("span",{className:"w-4"}),n("span",{children:"Save As..."})]})})},Lo=()=>n(Ue,{children:(e,t,s)=>u(G,{children:[u(D.Main,{innerRef:t,children:[n(lo,{}),n("span",{children:"File"})]}),e&&u(Q,{menuElement:s,children:[n(yo,{}),n(No,{onFileLoad:()=>s.click()}),n(Io,{}),n(Co,{})]})]})}),Do=()=>{const e=T(),t=I(As);return n(B.Expandable,{children:(s,r,a)=>u(G,{children:[u(D,{children:[n("span",{className:"w-4"}),n("span",{children:"Memory"})]}),s&&n(Q.Expanded,{innerRef:r,menuItemElement:a,children:Xr.map((o,c)=>n(B,{onClick:()=>{e.dispatch(ta(o))},children:u(D,{children:[t===o?n(ye,{}):n("span",{className:"w-4"}),n("span",{children:o})]})},c))})]})})},Ao=()=>{const e=T(),t=I(Va);return n(B.Expandable,{children:(s,r,a)=>u(G,{children:[u(D,{children:[n("span",{className:"w-4"}),n("span",{children:"I/O Devices"})]}),s&&n(Q.Expanded,{innerRef:r,menuItemElement:a,children:Us.map((o,c)=>n(B,{onClick:()=>{e.dispatch(Js(o))},children:u(D,{children:[t[o].isVisible?n(ye,{}):n("span",{className:"w-4"}),n("span",{children:hr(o)})]})},c))})]})})},ko=()=>n(Ue,{children:(e,t,s)=>u(G,{children:[u(D.Main,{innerRef:t,children:[n(uo,{}),n("span",{children:"View"})]}),e&&u(Q,{menuElement:s,children:[n(Do,{}),n(Ao,{})]})]})}),Mo=()=>{const e=T(),t=I(Ye);return n(B,{onClick:()=>{e.dispatch(xs(!t))},children:u(D,{children:[t?n(ye,{}):n("span",{className:"w-4"}),n("span",{children:"Auto Assemble"})]})})},To=()=>{const e=T(),t=I(_s);return n(B.Expandable,{children:(s,r,a)=>u(G,{children:[u(D,{children:[n("span",{className:"w-4"}),n("span",{children:"Clock Speed"})]}),s&&n(Q.Expanded,{innerRef:r,menuItemElement:a,children:Pr.map((o,c)=>n(B,{onClick:()=>{e.dispatch(Wr(Xe[o]))},children:u(D,{children:[t===Xe[o]?n(ye,{}):n("span",{className:"w-4"}),n("span",{children:o})]})},c))})]})})},Oo=()=>{const e=T(),t=I(ws);return n(B.Expandable,{children:(s,r,a)=>u(G,{children:[u(D,{children:[n("span",{className:"w-4"}),n("span",{children:"Timer Interval"})]}),s&&n(Q.Expanded,{innerRef:r,menuItemElement:a,children:Ur.map((o,c)=>n(B,{onClick:()=>{e.dispatch(Jr(Ze[o]))},children:u(D,{children:[t===Ze[o]?n(ye,{}):n("span",{className:"w-4"}),n("span",{children:o})]})},c))})]})})},Go=()=>n(Ue,{children:(e,t,s)=>u(G,{children:[u(D.Main,{innerRef:t,children:[n(ho,{}),n("span",{children:"Configuration"})]}),e&&u(Q,{menuElement:s,children:[n(Mo,{}),n(To,{}),n(Oo,{})]})]})});var X=(e=>(e.Whitespace="Whitespace",e.Comment="Comment",e.Colon="Colon",e.Comma="Comma",e.Digits="Digits",e.Register="Register",e.Address="Address",e.String="String",e.Unknown="Unknown",e))(X||{});const Bo=(e,t,s)=>{const r=ut(()=>{switch(e){case"Register":case"Unknown":return t.toUpperCase();case"Address":return lt(t).trim().toUpperCase();case"String":return JSON.parse(t);default:return t}}),a=s+t.length;return{type:e,value:r,raw:t,range:{from:s,to:a}}},Po=e=>{const t=Object.entries(e),s=new RegExp(t.map(([,a])=>`(${a.source})`).join("|"),"y");let r="";return{reset:a=>{r=a,s.lastIndex=0},next:()=>{const a=s.lastIndex,o=s.exec(r);if(o!==null&&o.index===a){for(let c=0;;c++)if(o[c+1]!==void 0){const[h]=t[c];return Bo(h,o[0],o.index)}}if(s.lastIndex=a,a<r.length)throw new Error(`Unexpected token '${r[a]}' at index ${a}.`);return null}}},qt=Po({Whitespace:/\s+/,Comment:/;.*/,Colon:/:/,Comma:/,/,Digits:/\d+\b/,Register:/[a-dA-D][lL]\b/,Address:/\[.*?\]/,String:/"(?:[^\\\r\n]|\\.)*?"/,Unknown:/[^\s;:,["]+|\[.*?(?=\s*?(?:[\r\n;:,]|$))|".*/}),Uo=e=>{qt.reset(e);const t=[];let s;for(;(s=qt.next())!==null&&!(s.type!=="Whitespace"&&s.type!=="Comment"&&(t.push(s),s.value===w.END)););return t};class wt extends Error{constructor(s,r){super(s);k(this,"range");this.range=r}toPlainObject(){return{name:this.name,message:this.message,range:this.range}}}class z extends wt{constructor(s,r){super(vr(gr(s)),r);k(this,"name","ParseError")}}class Fo extends z{constructor({raw:t,range:s},r){super(`Expected ${r?"":"label or "}instruction, got '${t}'.`,s)}}class Vo extends z{constructor({raw:t,range:s}){const r=t.replace(/:$/,"");super(`Label should contain only letter or underscore, got '${r}'.`,s)}}class Fe extends z{constructor(){super("Expected END at the end of the source code.")}}class Ho extends z{constructor({raw:t,range:s}){const r=lt(t).trim();super(`Number '${r}' is greater than FF.`,s)}}class Wo extends z{constructor({value:t,range:s},r){super(`UTF-16 code of character '${t[r]}' is greater than FF.`,s)}}class Jo extends z{constructor({raw:t,range:s}){const r=lt(t).trim();super(`Expected number or register, got '${r.length>0?r:"]"}'.`,s)}}class zo extends z{constructor({raw:t,range:s}){super(`Unterminated address '${t.trimEnd()}'.`,s)}}class $o extends z{constructor({raw:t,range:s}){super(`Unterminated string '${t}'.`,s)}}class jo extends z{constructor({range:t}){super("Single quote is not allowed.",t)}}class Ko extends z{constructor({raw:t,range:s},...r){const a=r.map(o=>o.replace(/[A-Z]/g,c=>` ${c.toLowerCase()}`).trimStart()).reduce((o,c,h)=>{switch(h){case 0:return c;case r.length-1:return`${o} or ${c}`;default:return`${o}, ${c}`}},"");super(`Expected ${a}, got '${t}'.`,s)}}class Xo extends z{constructor({raw:t,range:s}){super(`Expected comma, got '${t}'.`,s)}}class Ve extends wt{constructor(){super(...arguments);k(this,"name","AssembleError")}}class Zo extends Ve{constructor({identifier:t,range:s}){super(`Duplicate label '${t}'.`,s)}}class Yo extends Ve{constructor({range:t}){super("Can not generate code beyond the end of RAM.",t)}}class qo extends Ve{constructor({raw:t,range:s}){super(`Label '${t}' does not exist.`,s)}}class Qo extends Ve{constructor({range:t}){super("Jump distance should be between -128 and 127.",t)}}const ei=({value:e,range:t})=>({identifier:e,range:t}),ti=({value:e,range:t})=>({mnemonic:e,opcode:null,range:t});var xt=(e=>(e.Number="Number",e.Register="Register",e.Address="Address",e.RegisterAddress="RegisterAddress",e.String="String",e.Label="Label",e))(xt||{});const ie=(e,t)=>{const s=ut(()=>{switch(e){case"Number":case"Address":return fs(t.value);case"Register":case"RegisterAddress":return se[t.value];case"String":return Er(t.value);case"Label":return}}),{value:r,raw:a,range:o}=t;return{type:e,value:s,rawValue:r,raw:a,range:o}},si=(e,t,s)=>{const r=[];t.opcode!==null&&r.push(t.opcode),s.forEach(h=>{h.value!==void 0&&(typeof h.value=="number"?r.push(h.value):r.push(...h.value))});const a=t.range.from,c=(s.length>0?s[s.length-1]:t).range.to;return{label:e,instruction:t,operands:s,machineCode:r,range:{from:a,to:c}}},ni=/^[A-Z_]+$/,rn=e=>{if(!ni.test(e.value))throw new Vo(e);return e},ri=(e,t)=>{var s;return((s=e[t+1])==null?void 0:s.type)!==X.Colon?null:ei(rn(e[t]))},ze=e=>{if(fs(e.value)>255)throw new Ho(e);return e},ai=e=>{for(let t=0;t<e.value.length;t++)if(e.value.charCodeAt(t)>255)throw new Wo(e,t);return e},Qt=/^[\dA-F]+$/,oi=/^[A-D]L$/,at=(e,t)=>(...s)=>{if(t>=e.length)throw new Fe;const r=e[t];let a;const o=c=>s.includes(c);switch(r.type){case X.Digits:if(o(a="Number"))return ie(a,ze(r));break;case X.Register:if(o(a="Register"))return ie(a,r);break;case X.Address:if(o(a="Address")&&Qt.test(r.value))return ie(a,ze(r));if(o(a="RegisterAddress")){if(oi.test(r.value))return ie(a,r);throw new Jo(r)}break;case X.String:if(o(a="String"))return ie(a,ai(r));break;case X.Unknown:if(r.raw.startsWith("["))throw new zo(r);if(r.raw.startsWith('"'))throw new $o(r);if(r.raw.startsWith("'"))throw new jo(r);if(o(a="Number")&&Qt.test(r.value))return ie(a,ze(r));if(o(a="Label"))return ie(a,rn(r));break}throw new Ko(r,...s)},ii=(e,t)=>{if(t>=e.length)return new Fe;const s=e[t];return s.type!==X.Comma?new Xo(s):null},ci=(e,t)=>(...s)=>{const r=[];s.forEach(([g])=>{r.includes(g)||r.push(g)});const a=at(e,t)(...r),o=ii(e,t+1);if(o!==null)throw o;const c=[];s.forEach(([g,l])=>{g===a.type&&c.push(l)});const h=at(e,t+2)(...c);return[a,h]},li=(e,t)=>{const s=()=>t+r;let r=0;const a=b=>{r+=b},o=ri(e,s()),c=o!==null;c&&a(2);const h=e[s()];if(h===void 0)throw new Fe;if(h.type!==X.Unknown||!(h.value in w))throw new Fo(h,c);a(1);const g=ti(h),l=b=>{g.opcode=b},E=[],C=(...b)=>{E.push(...b)},N=h.value;switch(ys[N]){case 0:{l(p[N]);break}case 1:{let b;const m=at(e,s());switch(N){case w.INC:l(p.INC_REG),b=m("Register");break;case w.DEC:l(p.DEC_REG),b=m("Register");break;case w.NOT:l(p.NOT_REG),b=m("Register");break;case w.ROL:l(p.ROL_REG),b=m("Register");break;case w.ROR:l(p.ROR_REG),b=m("Register");break;case w.SHL:l(p.SHL_REG),b=m("Register");break;case w.SHR:l(p.SHR_REG),b=m("Register");break;case w.JMP:l(p.JMP),b=m("Label");break;case w.JZ:l(p.JZ),b=m("Label");break;case w.JNZ:l(p.JNZ),b=m("Label");break;case w.JS:l(p.JS),b=m("Label");break;case w.JNS:l(p.JNS),b=m("Label");break;case w.JO:l(p.JO),b=m("Label");break;case w.JNO:l(p.JNO),b=m("Label");break;case w.PUSH:l(p.PUSH_FROM_REG),b=m("Register");break;case w.POP:l(p.POP_TO_REG),b=m("Register");break;case w.CALL:l(p.CALL_ADDR),b=m("Number");break;case w.INT:l(p.INT_ADDR),b=m("Number");break;case w.IN:l(p.IN_FROM_PORT_TO_AL),b=m("Number");break;case w.OUT:l(p.OUT_FROM_AL_TO_PORT),b=m("Number");break;case w.ORG:b=m("Number");break;case w.DB:b=m("Number","String");break}C(b),a(1);break}case 2:{let b,m;const f=ci(e,s());switch(N){case w.ADD:switch([b,m]=f(["Register","Register"],["Register","Number"]),m.type){case"Register":l(p.ADD_REG_TO_REG);break;case"Number":l(p.ADD_NUM_TO_REG);break}break;case w.SUB:switch([b,m]=f(["Register","Register"],["Register","Number"]),m.type){case"Register":l(p.SUB_REG_FROM_REG);break;case"Number":l(p.SUB_NUM_FROM_REG);break}break;case w.MUL:switch([b,m]=f(["Register","Register"],["Register","Number"]),m.type){case"Register":l(p.MUL_REG_BY_REG);break;case"Number":l(p.MUL_REG_BY_NUM);break}break;case w.DIV:switch([b,m]=f(["Register","Register"],["Register","Number"]),m.type){case"Register":l(p.DIV_REG_BY_REG);break;case"Number":l(p.DIV_REG_BY_NUM);break}break;case w.MOD:switch([b,m]=f(["Register","Register"],["Register","Number"]),m.type){case"Register":l(p.MOD_REG_BY_REG);break;case"Number":l(p.MOD_REG_BY_NUM);break}break;case w.AND:switch([b,m]=f(["Register","Register"],["Register","Number"]),m.type){case"Register":l(p.AND_REG_WITH_REG);break;case"Number":l(p.AND_REG_WITH_NUM);break}break;case w.OR:switch([b,m]=f(["Register","Register"],["Register","Number"]),m.type){case"Register":l(p.OR_REG_WITH_REG);break;case"Number":l(p.OR_REG_WITH_NUM);break}break;case w.XOR:switch([b,m]=f(["Register","Register"],["Register","Number"]),m.type){case"Register":l(p.XOR_REG_WITH_REG);break;case"Number":l(p.XOR_REG_WITH_NUM);break}break;case w.MOV:switch([b,m]=f(["Register","Number"],["Register","Address"],["Address","Register"],["Register","RegisterAddress"],["RegisterAddress","Register"]),b.type){case"Register":switch(m.type){case"Number":l(p.MOV_NUM_TO_REG);break;case"Address":l(p.MOV_ADDR_TO_REG);break;case"RegisterAddress":l(p.MOV_REG_ADDR_TO_REG);break}break;case"Address":l(p.MOV_REG_TO_ADDR);break;case"RegisterAddress":l(p.MOV_REG_TO_REG_ADDR)}break;case w.CMP:switch([b,m]=f(["Register","Register"],["Register","Number"],["Register","Address"]),m.type){case"Register":l(p.CMP_REG_WITH_REG);break;case"Number":l(p.CMP_REG_WITH_NUM);break;case"Address":l(p.CMP_REG_WITH_ADDR);break}break}C(b,m),a(3);break}}return[si(o,g,E),r]},di=e=>{const t=[];for(let s=0;s<e.length;){const[r,a]=li(e,s);t.push(r),s+=a}if(t.length>0&&t[t.length-1].instruction.mnemonic!==w.END)throw new Fe;return t},ui=e=>{let t=0;const s={};return e.forEach((r,a)=>{const{label:o,instruction:c,operands:h,machineCode:g}=r;if(o!==null){if(o.identifier in s)throw new Zo(o);s[o.identifier]=t}const l=h[0];if(c.mnemonic===w.ORG)t=l.value;else if(t+=g.length+((l==null?void 0:l.type)===xt.Label?1:0),t>255&&a!==e.length-1)throw new Yo(r)}),s},hi=e=>{const t=di(Uo(e)),s=ui(t);let r=0;const a={},o={};return t.forEach(c=>{const{instruction:h,operands:g,machineCode:l}=c,E=g[0];if(h.mnemonic===w.ORG){r=E.value;return}if((E==null?void 0:E.type)===xt.Label){if(!(E.rawValue in s))throw new qo(E);const N=s[E.rawValue]-r;if(N<-128||N>127)throw new Qo(E);const L=hs(N);E.value=L,l.push(L)}const C=r+l.length;l.forEach((N,L)=>{a[r+L]=N}),o[r]=c,r=C}),[a,o]},an=e=>(t=we(e.getState()))=>{let s;try{s=hi(t)}catch(h){if(h instanceof wt){const g=h.toPlainObject();e.dispatch(Ee()),e.dispatch(Tr(g))}else{const g=Be(h);e.dispatch(vt(g))}return}const[r,a]=s,o=a[0],c=o!==void 0;e.dispatch(ks(r)),e.dispatch(bt()),e.dispatch(Ss({source:t,addressToStatementMap:a})),e.dispatch(c?Rs(o):Ee())},pi={type:ce.Warning,content:"Warning: Source code has changed since last assemble."};class fi{constructor(t){k(this,"getState");k(this,"dispatch");k(this,"stepIntervalId");k(this,"interruptIntervalId");k(this,"isInterruptIntervalSet",!1);k(this,"lastStep",Promise.resolve(void 0));k(this,"dispatchChangesTimeoutId");k(this,"unsubscribeSetSuspended");k(this,"lastBreakpointLineNumber");k(this,"assemble");k(this,"runOrStop",async()=>{this.stopIfRunning(this.getState())||await this.run()});k(this,"stopAndRun",async()=>{this.cancelMainLoop(),this.resumeMainLoop(),await this.step()});k(this,"step",async()=>{const t=await this.lastStep,s=this.getState();we(s)!==kr(s)&&this.dispatch(Ke(pi));const{fault:r,halted:a}=Na(s);if(r!==null||a){this.stopIfRunning(s),r===null&&a&&this.dispatch(rt());return}pe(s)||(this.lastStep=new Promise(o=>{var W,ge;let c;try{c=ya(t!=null?t:{memoryData:gt(s),cpuRegisters:Ca(s)},Pa(s))}catch(x){if(this.stopIfRunning(s),x instanceof q){const U=x.toPlainObject();this.dispatch(Ta(U))}else{const U=Be(x);this.dispatch(vt(U))}o(void 0);return}const{memoryData:h,cpuRegisters:g,signals:l,changes:E}=c,C=g.ip,L=vs(s)[C],b=L==null?void 0:L.machineCode.every((x,U)=>x===h[C+U]);let m=!1;if(E.memoryData!==void 0){const{address:x}=E.memoryData;x>=xe&&(m=!0)}const f=()=>{this.dispatchChangesTimeoutId=window.setTimeout(()=>{this.dispatch(Qr(h)),m&&this.dispatch(Hs(h)),this.dispatch(Oa(g)),this.dispatch(b?Rs(L):Ee()),this.dispatchChangesTimeoutId=void 0})};let j=!1;(this.dispatchChangesTimeoutId===void 0||m)&&(j=!0,f());const{data:S,interrupt:y}=l.input,{halted:ne=!1,requiredInputPort:O,data:V,closeWindows:d=!1}=l.output;if(y&&this.dispatch(Kt(!1)),ne){this.stopIfRunning(s),this.dispatch(rt()),o(void 0);return}const H=Se(s);let K=!1;if(O!==void 0)if(this.dispatch(Xt(!0)),S.content===null){switch(K=!0,H&&this.cancelMainLoop(),this.dispatch(Ce(!0)),O){case Rt.SimulatedKeyboard:this.dispatch(Vs(!0));break}this.unsubscribeSetSuspended=F(Ce,async()=>{H&&this.resumeMainLoop(),await this.step()},{once:!0})}else this.dispatch(jt());else Ua(s)&&(this.dispatch(Xt(!1)),this.dispatch(jt()));if((V==null?void 0:V.content)!==void 0){const{content:x,port:U}=V,ae=ut(()=>{switch(U){case nt.TrafficLights:return le.TrafficLights;case nt.SevenSegmentDisplay:return le.SevenSegmentDisplay}});ae!==void 0&&this.dispatch(Ws({name:ae,data:x}))}if(H){const x=Gs(g.sr,Os.Interrupt);((ge=(W=E.cpuRegisters.sr)==null?void 0:W.interrupt)!=null?ge:!1)?x?this.isInterruptIntervalSet||(this.setInterruptInterval(),this.isInterruptIntervalSet=!0):this.isInterruptIntervalSet&&(this.clearInterruptInterval(),this.isInterruptIntervalSet=!1):x&&!this.isInterruptIntervalSet&&(this.setInterruptInterval(),this.isInterruptIntervalSet=!0)}d&&this.dispatch(za());const re=pt(s);let J=!1;if(re.length>0&&b&&H&&!K){const{label:x,range:U}=L,ae={from:x===null?U.from:x.range.from,to:U.to},i=re.find(v=>er(v,ae));i!==void 0&&(J=!0,i.number!==this.lastBreakpointLineNumber&&(j||f(),this.stop(),this.lastBreakpointLineNumber=i.number))}!J&&this.lastBreakpointLineNumber!==void 0&&this.resetBreakpointLineNumber(),o({memoryData:h,cpuRegisters:g})}))});k(this,"reset",()=>{this.fullyStop(),this.dispatch(ea()),this.dispatch(bt()),this.dispatch(Gr()),this.dispatch(Ee()),this.dispatch(zs())});k(this,"fullyStop",()=>{const t=this.getState();this.stopIfRunning(t),this.cancelDispatchChanges(),this.restoreIfSuspended(t),this.resetBreakpointLineNumber(),this.resetLastStep()});this.getState=t.getState,this.dispatch=t.dispatch;const s=an(t);this.assemble=()=>s()}stopIfRunning(t){const s=Se(t);return s&&this.stop(),s}stop(){this.clearStepInterval(),this.isInterruptIntervalSet&&(this.clearInterruptInterval(),this.isInterruptIntervalSet=!1),this.dispatch(Bt(!1))}clearStepInterval(){window.clearInterval(this.stepIntervalId)}clearInterruptInterval(){window.clearInterval(this.interruptIntervalId)}restoreIfSuspended(t){pe(t)&&(this.unsubscribeSetSuspended(),this.dispatch(Ce(!1)))}async run(){this.dispatch(Bt(!0)),this.setStepInterval(),await this.step()}setStepInterval(){const{clockSpeed:t}=qe(this.getState());this.stepIntervalId=window.setInterval(this.step,1e3/t)}cancelMainLoop(){this.clearStepInterval(),this.isInterruptIntervalSet&&this.clearInterruptInterval()}resumeMainLoop(){this.setStepInterval(),this.isInterruptIntervalSet&&this.setInterruptInterval()}setInterruptInterval(){const{timerInterval:t}=qe(this.getState());this.interruptIntervalId=window.setInterval(()=>{this.dispatch(Kt(!0))},t)}resetBreakpointLineNumber(){this.lastBreakpointLineNumber=void 0}cancelDispatchChanges(){this.dispatchChangesTimeoutId!==void 0&&(window.clearTimeout(this.dispatchChangesTimeoutId),this.dispatchChangesTimeoutId=void 0)}resetLastStep(){this.lastStep=Promise.resolve(void 0)}}const gi=()=>{const e=T(),t=Zs(()=>new fi(e));return R.exports.useEffect(()=>F(Y,t.fullyStop),[]),R.exports.useEffect(()=>F(xs,s=>{s&&window.setTimeout(()=>{t.assemble()},Me)}),[]),R.exports.useEffect(()=>F(Ss,t.fullyStop),[]),R.exports.useEffect(()=>Pe(qe,async(s,r)=>{const a=r.getState();!pe(a)&&Se(a)&&await t.stopAndRun()}),[]),t},Ie=({children:e,onClick:t,disabled:s=!1})=>n("div",{className:P("flex space-x-2 py-1 px-2 items-center",s?"text-gray-400 fill-gray-400":"hover:bg-gray-200"),onClick:s?void 0:t,children:e}),mi=()=>{const e=gi();return u(G,{children:[n(()=>u(Ie,{onClick:e.assemble,children:[n(po,{}),n("span",{children:"Assemble"})]}),{}),n(()=>{const o=I(Se),c=I(pe);return n(Ie,{disabled:c,onClick:e.runOrStop,children:o?u(G,{children:[n(fo,{}),n("span",{children:"Stop"})]}):u(G,{children:[n(tn,{}),u("span",{children:["Run",ue]})]})})},{}),n(()=>{const o=I(Se),c=I(pe);return u(Ie,{disabled:o||c,onClick:e.step,children:[n(go,{}),n("span",{children:"Step"})]})},{}),n(()=>u(Ie,{onClick:e.reset,children:[n(mo,{}),n("span",{children:"Reset"})]}),{})]})},es=document.getElementById("modal-root"),yt=({children:e,isOpen:t=!1,className:s=""})=>{const r=R.exports.useRef(),[a,o]=R.exports.useState(!1),c=t&&a;return R.exports.useEffect(()=>{if(!t)return;if(r.current===void 0){const g=document.createElement("div");g.className=s,r.current=g}const{current:h}=r;return es.appendChild(h),o(!0),()=>{r.current=void 0,es.removeChild(h),o(!1)}},[t,s]),c?wn.exports.createPortal(e,r.current):null},be=({href:e,children:t})=>{const s=e.startsWith("http");return n("a",M(A({className:"text-blue-700 hover:underline",href:e},s?{rel:"noopener noreferrer",target:"_blank"}:void 0),{children:t}))},Ri=()=>n(B.ExternalLink,{href:"http://www.softwareforeducation.com/sms32v50/sms32v50_manual/250-FullIset.htm",children:u(D,{children:[n("span",{className:"w-4"}),n("span",{children:"Instruction Set"})]})}),bi=()=>n(B.ExternalLink,{href:"https://github.com/exuanbo/assembler-simulator/issues",children:u(D,{children:[n("span",{className:"w-4"}),n("span",{children:"Bug Report"})]})}),vi=({onClick:e})=>n(B,{onClick:e,children:u(D,{children:[n("span",{className:"w-4"}),n("span",{children:"About"})]})}),Ei=({isOpen:e,toggleOpen:t})=>{const s=St(t);return n(yt,{className:"bg-black flex bg-opacity-20 inset-0 fixed items-center justify-center",isOpen:e,children:u("div",{ref:s,className:"rounded space-y-2 bg-light-100 shadow text-center py-4 px-8 select-text all:select-text",onClick:a=>{a.stopPropagation()},children:[n("img",{alt:"icon",className:"mx-auto",height:"72",src:"./pwa-192x192.png",width:"72"}),n("div",{className:"font-bold",children:"Assembler Simulator"}),u("div",{className:"space-y-4 text-sm",children:[u("div",{children:[u("div",{children:["Version ","1.0.0-alpha.3"]}),u("div",{children:["Build"," ",n(be,{href:"https://github.com/exuanbo/assembler-simulator/commits/3b0c179",children:"3b0c179"})]})]}),u("div",{children:[n(be,{href:"https://github.com/exuanbo/assembler-simulator/blob/main/LICENSE",children:"GPL-3.0 License"})," ",n("span",{className:"font-sans",children:"\xA9"})," 2022"," ",n(be,{href:"https://github.com/exuanbo",children:"Exuanbo"})]})]})]})})},Si=()=>{const[e,t]=Et(!1);return n(Ue,{children:(s,r,a)=>u(G,{children:[n(D.Main,{innerRef:r,children:n(Ro,{})}),s&&u(Q,{menuElement:a,children:[n(Ri,{}),n(bi,{}),n(vi,{onClick:t})]}),n(Ei,{isOpen:e,toggleOpen:t})]})})},_i=()=>{const[e,t]=R.exports.useState(null),s=R.exports.useMemo(()=>({currentOpen:e,setCurrentOpen:t}),[e]),r=R.exports.useCallback(()=>{e!==null&&t(null)},[e]),a=St(r);return R.exports.useEffect(()=>{a(e)},[e]),u("div",{className:"border-y flex flex-row-reverse min-w-max bg-gray-100 h-8 w-full z-10 fixed items-center justify-between",children:[u(D.Main,{children:[n("h1",{children:"Assembler Simulator"}),n(be,{href:"https://github.com/exuanbo/assembler-simulator",children:n(vo,{className:"w-4.5"})})]}),n("div",{className:"divide-x border-r flex",children:u(qs.Provider,{value:s,children:[n(Lo,{}),n(ko,{}),n(Go,{}),n(mi,{}),n(Si,{})]})})]})},wi=.25,ts=.75,xi=({children:e,className:t})=>{const[s,r]=e,[a,o]=R.exports.useState(),c=a!==void 0,h=R.exports.useRef(null),g=R.exports.useRef(null),l=R.exports.useRef(null),E=()=>g.current.offsetWidth,C=()=>h.current.offsetWidth-E(),N=()=>.5*C(),L=()=>C()-l.current.offsetWidth;R.exports.useEffect(()=>{o(N())},[]),R.exports.useEffect(()=>{if(!c)return;const y=L();a>y&&o(y)},[c,a]);const[b,m]=R.exports.useState(!1),f=R.exports.useRef(0),j=R.exports.useRef(),S=()=>{m(!0),f.current+=1,f.current===2?(o(N()),window.clearTimeout(j.current),f.current=0):j.current=window.setTimeout(()=>{f.current=0},500)};return R.exports.useEffect(()=>{if(!b)return;const y=xr(O=>{const V=E(),d=O.clientX-V/2,H=C(),K=d/H,re=ur(K,wi,ts),J=re*H;if(re===ts){const W=L();if(J>W){o(W);return}}o(J)},10),ne=()=>{m(!1)};return document.addEventListener("mousemove",y),document.addEventListener("mouseup",ne),()=>{document.removeEventListener("mousemove",y),document.removeEventListener("mouseup",ne)}},[b]),u(G,{children:[u("div",{ref:h,className:P("flex",t),children:[n("div",{className:P({hidden:!c}),style:{width:a},children:s}),n("div",{ref:g,className:P("border-x cursor-col-resize flex flex-col space-y-2 px-1 justify-center group hover:bg-gray-200",c?b?"bg-gray-200":"bg-gray-100":"invisible"),onMouseDown:S,children:he(3).map(y=>n("span",{className:P("rounded-full h-1 w-1 group-hover:bg-slate-400",b?"bg-slate-400":"bg-slate-300")},y))}),n("div",{ref:l,className:P("flex-1",{hidden:!c}),children:r})]}),b&&n("div",{className:"cursor-col-resize inset-0 z-10 fixed"})]})};class yi extends R.exports.Component{componentDidCatch(t){this.props.onError(Be(t))}render(){return this.props.children}}const Ni=({children:e})=>{const t=T();return n(yi,{onError:r=>{const a=Be(r);t.dispatch(vt(a))},children:e})},Nt=R.exports.createContext({view:void 0,ref:gs}),Ii=e=>{const[t,s]=R.exports.useState(null),r=R.exports.useCallback(c=>{s(c)},[]),[a,o]=R.exports.useState();return R.exports.useEffect(()=>{if(t===null)return;const c=xn.create(e),h=new $({state:c,parent:t});return o(h),()=>{h.destroy(),o(void 0)}},[t,e]),{view:a,ref:r}},fe=()=>{const{view:e}=R.exports.useContext(Nt);return e},Ci=()=>{const{ref:e}=R.exports.useContext(Nt);return e},It=e=>({effects:Ge.appendConfig.of($.updateListener.of(e))}),ot=Ge.define({map({add:e,filter:t},s){return{add:e===void 0?void 0:{from:s.mapPos(e.from),to:s.mapPos(e.to)},filter:t}}}),Li=ve.mark({class:"cm-wavyUnderline"}),Di=ct.define({create(){return ve.none},update(e,t){return t.effects.reduce((s,r)=>{if(!r.is(ot))return s;const{add:a,filter:o}=r.value;return s.update({add:a===void 0?void 0:[Li.range(a.from,a.to)],filter:o})},e.map(t.changes))},provide:e=>$.decorations.from(e)}),Ai=`url('data:image/svg+xml;base64,${window.btoa(`<svg height="4" width="6" xmlns="http://www.w3.org/2000/svg">
  <path fill="none" stroke="red" d="m0 3 l2 -2 l1 0 l2 2 l1 0" />
</svg>`)}')`,ki=()=>[Di,$.baseTheme({".cm-wavyUnderline":{background:`${Ai} left bottom repeat-x`,paddingBottom:"2px"}})],on=yn.define({combine(e){return Nn(e,{clearOnPointerSelect:!0},{clearOnPointerSelect(t,s){return s}})}}),it=Ge.define({map({addByPos:e,filter:t},s){return{addByPos:e===void 0?void 0:s.mapPos(e),filter:t}}}),Mi=ve.line({attributes:{class:"cm-highlightLine"}}),Ti=ct.define({create(){return ve.none},update(e,t){const{clearOnPointerSelect:s}=t.state.facet(on);return s&&t.isUserEvent("select.pointer")?ve.none:t.effects.reduce((r,a)=>{if(!a.is(it))return r;const{addByPos:o,filter:c}=a.value;return r.update({add:o===void 0?void 0:[Mi.range(o)],filter:c})},e.map(t.changes))},provide:e=>$.decorations.from(e)}),Oi=(e={})=>[on.of(e),Ti,$.baseTheme({".cm-highlightLine":{backgroundColor:"#dcfce7 !important"}})],He=Ge.define({map(e,t){return{pos:t.mapPos(e.pos),on:e.on}}});class Gi extends In{toDOM(){return document.createTextNode("\u25CF")}}const cn=new Gi,ln=ct.define({create(){return Cn.empty},update(e,t){return t.effects.reduce((s,r)=>r.is(He)?s.update(r.value.on?{add:[cn.range(r.value.pos)]}:{filter:a=>a!==r.value.pos}):s,e.map(t.changes))}}),Oe=e=>e.field(ln),Bi=(e,t)=>{const s=Oe(e.state);let r=!1;s.between(t,t,()=>{r=!0}),e.dispatch({effects:He.of({pos:t,on:!r})})},dn=(e,t,s)=>s.offsetY>t.bottom?!1:(Bi(e,t.from),!0),Pi=()=>[ln,Ln({class:"cm-breakpoints",markers:e=>Oe(e.state),initialSpacer:()=>cn,domEventHandlers:{mousedown:dn}}),$.baseTheme({".cm-breakpoints .cm-gutterElement":{width:"20px",padding:"0 3px 0 5px",color:"red",cursor:"pointer"}})],Ui=(e,t)=>{if(t.size!==e.size)return!1;if(t.size===0)return!0;const s=t.iter(),r=e.iter();for(let a=0;a<t.size;a++,s.next(),r.next())if(s.from!==r.from||s.to!==r.to)return!1;return!0},Ct=Dn.define(),Fi=e=>t=>t.annotation(Ct)===e,Vi=(e,t)=>{const s=new Array(e.size),r=e.iter();for(let a=0;a<e.size;a++,r.next())s[a]=t(r.from,r.to,r.value);return s},un=Fi("ChangedFromState"),Hi=e=>{let t;return s=>{if(!s.docChanged)return;const r=s.transactions[0],a=os(s.state.doc);t!==void 0&&window.clearTimeout(t),t=window.setTimeout(()=>{un(r)||e.dispatch(Y({value:a})),t=void 0},Me)}},Wi=()=>{const e=fe(),t=T();R.exports.useEffect(()=>{if(e!==void 0)return e.dispatch(It(Hi(t))),F(Y,({value:s,isFromFile:r})=>{r&&e.dispatch({changes:{from:0,to:e.state.doc.length,insert:s},annotations:Ct.of("ChangedFromState")})})},[e])},Ji=()=>{const e=fe();R.exports.useEffect(()=>{if(e!==void 0)return F(Y,({value:t,isFromFile:s})=>{if(s&&t===je.content){e.focus();const{title:r,content:a}=je,o=a.indexOf(r);e.dispatch({selection:{anchor:o,head:o+r.length}})}})},[e])},zi=()=>{const e=fe(),t=T(),s=Zs(()=>an(t));R.exports.useEffect(()=>{e!==void 0&&Ye(t.getState())&&window.setTimeout(()=>{s(os(e.state.doc))},Me)},[e]),R.exports.useEffect(()=>F(Y,({value:r,isFromFile:a},o)=>{Ye(o.getState())&&(a?window.setTimeout(()=>{s(r)},Me):s(r))}),[])},$i=()=>{const e=fe(),t=T();R.exports.useEffect(()=>{e==null||e.dispatch(It(s=>{Es(t.getState())!==null&&s.docChanged&&(s.view.dispatch({effects:ot.of({filter:()=>!1})}),t.dispatch(Or()))}))},[e]),R.exports.useEffect(()=>{if(e!==void 0)return Pe(Mr,s=>{e.dispatch({effects:ot.of({add:s,filter:()=>s!==void 0})})})},[e])},ji=()=>{const e=fe();R.exports.useEffect(()=>F(Y,({isFromFile:t},s)=>{t&&s.dispatch(Ee())}),[]),R.exports.useEffect(()=>{if(e!==void 0)return Pe(Ir(e),t=>{e.dispatch(A({effects:t===void 0?it.of({filter:()=>!1}):t.map((s,r)=>it.of({addByPos:s,filter:()=>r!==0}))},e.hasFocus||t===void 0?void 0:{selection:{anchor:t[0]},scrollIntoView:!0}))})},[e])},Ki=e=>t=>{if(t.docChanged){const s=Oe(t.state);if(!Ui(Oe(t.startState),s)){const r=Vi(s,a=>$e(t.state.doc,a));e.dispatch(ms(r))}}else{const s=t.transactions[0];if(s===void 0||un(s))return;s.effects.forEach(r=>{if(r.is(He)){const a=r.value.on?Lr:Dr,o=$e(t.state.doc,r.value.pos);e.dispatch(a(o))}})}},Xi=()=>{const e=fe(),t=T();R.exports.useEffect(()=>{if(e===void 0)return;e.dispatch(It(Ki(t)));const s=pt(t.getState()),r=s.filter(a=>a.to<=e.state.doc.length&&is(a,$e(e.state.doc,a.from)));r.length<s.length&&t.dispatch(ms(r)),e.dispatch({effects:r.map(a=>He.of({pos:a.from,on:!0})),annotations:Ct.of("ChangedFromState")})},[e])},Zi=2e3,ss={type:ce.Info,content:"Info: Program has halted."},Yi=e=>({type:ce.Error,content:`${e.name}: ${e.message}`}),qi=()=>{const e=I(Es),t=I(Ia),s=e!=null?e:t,r=I(Tt),a=R.exports.useRef();return R.exports.useEffect(()=>F(Ke,(o,c)=>{a.current!==void 0&&window.clearTimeout(a.current),a.current=window.setTimeout(()=>{c.dispatch(Ot()),a.current=void 0},Zi)}),[]),R.exports.useEffect(()=>F(rt,(o,c)=>{c.dispatch(Ke(ss))}),[]),R.exports.useEffect(()=>F(bt,(o,c)=>{Tt(c.getState())===ss&&(window.clearTimeout(a.current),a.current=void 0,c.dispatch(Ot()))}),[]),s!==null?Yi(s):r},Qi=({className:e})=>{const t=Ci();return Wi(),Ji(),zi(),$i(),ji(),Xi(),n("div",{ref:t,className:P("cursor-auto select-auto overflow-y-auto",e)})},ec=e=>{switch(e){case ce.Error:return"bg-red-500";case ce.Warning:return"bg-yellow-500";case ce.Info:return"bg-blue-500"}},tc=()=>{const e=qi();return e===null?null:n("div",{className:P("py-1 px-2 text-light-100",ec(e.type)),children:e.content})},sc=()=>$.theme({"&":{height:"100%"},"&.cm-focused":{outline:"0"},".cm-scroller":{fontFamily:"'Jetbrains Mono', monospace"},".cm-gutters":{borderRight:"1px solid #e5e7eb",backgroundColor:"#f3f4f6",color:"#9ca3af"},".cm-breakpoints":{fontSize:"0.875em"},".cm-lineNumbers":{paddingRight:"6px"},".cm-cursor":{borderLeft:"2px solid black"}}),nc=/[,[\]:]/,rc=/^[a-zA-Z_]+(?=:)/,ac=/^[a-zA-Z_]+/,oc=/^[^\s;:,["]+/,ic=/^[\da-fA-F]+\b/,cc=/^[a-dA-D][lL]\b/,lc=/\S/,dc=An.define({token(e,t){var s;if(t.ended)return e.skipToEnd(),"comment";if(e.eatSpace()||e.eat(nc))return null;if(e.eat(";"))return e.skipToEnd(),"comment";if(e.match(rc))return t.operandsLeft=0,"labelName";if(t.operandsLeft===0){const r=(s=e.match(oc))==null?void 0:s[0];if(r){const a=r.toUpperCase();if(a in w){const o=a;return o===w.END&&(t.ended=!0),t.operandsLeft=ys[o],t.expectLabel=o.startsWith("J"),"keyword"}else return null}}else{if(e.match(ic))return t.operandsLeft-=1,"number";if(e.match(cc))return t.operandsLeft-=1,"variableName.special";if(e.eat('"')){e.skipToEnd();const r=e.current();let a=0;for(let c=1;c<r.length;c++)if(r[c]==='"'&&r[c-1]!=="\\"){a=c;break}const o=r.length-1;return a!==0&&a!==o&&e.backUp(o-a),t.operandsLeft-=1,"string"}if(t.expectLabel&&e.match(ac))return t.operandsLeft-=1,t.expectLabel=!1,"labelName";t.operandsLeft=0}return e.eatWhile(lc),null},startState(){return{ended:!1,operandsLeft:0,expectLabel:!1}}}),uc=/^ */,hc=/^\s*/,pc=()=>[new kn(dc),Mn(Tn),On.of("	"),Gn.of(({state:e},t)=>{var c,h;const s=e.doc.lineAt(t).text.replace(uc,""),r=(h=(c=hc.exec(s))==null?void 0:c[0].split(""))!=null?h:[],a=r.reduce((g,l)=>l==="	"?g+1:g,0),o=r.length-a;return a*e.tabSize+o})],fc=()=>[Bn(),$.baseTheme({"&.cm-focused .cm-activeLine":{boxShadow:"inset 0 0 0 2px #e5e7eb"},".cm-activeLine":{backgroundColor:"inherit"}})],gc=()=>[Pn({domEventHandlers:{mousedown:dn}}),$.baseTheme({".cm-lineNumbers .cm-gutterElement":{cursor:"pointer"}})],mc={key:"Tab",run:Un,shift:Fn},Rc=[Vn(),Hn(),Wn(),sc(),pc(),fc(),Pi(),gc(),ki(),Oi(),Jn.of([...zn,...$n,...jn,mc])],bc=()=>{const e=T(),t=R.exports.useMemo(()=>({doc:we(e.getState()),extensions:Rc}),[]),s=Ii(t);return u("div",{className:"flex flex-col h-full",children:[n(Nt.Provider,{value:s,children:n(Qi,{className:"flex-1"})}),n(tc,{})]})},We=({title:e,onClick:t,children:s})=>u("header",{className:P("border-b flex space-x-2 bg-gray-100 py-1 px-2 items-center justify-between",{"cursor-pointer":t!==void 0}),onClick:t,children:[n("span",{children:e}),s]});var Ae=(e=>(e.Hex="hex",e.Bin="bin",e.Dec="dec",e))(Ae||{});const vc=({label:e,value:t,valueClassName:s})=>n("td",{className:"px-2",children:u("div",{className:"flex space-x-1 items-center justify-center",children:[n("span",{className:"rounded bg-gray-100 text-xs px-1 text-gray-400",children:e}),n("span",{className:P("rounded text-sm px-1",s),children:t})]})}),Ec=()=>n("td",{className:"px-2",children:u("div",{className:"flex space-x-1 items-center justify-center",children:[n("span",{className:"text-xs px-1",children:ue.repeat(3)}),n("span",{className:"text-sm px-1",children:`${ue.repeat(3)}ISOZ${ue}`})]})});var ke=Object.assign(vc,{FlagIndicator:Ec});const Sc=R.exports.memo(({name:e,value:t,valueClassName:s})=>{const r=te(t),a=ps(t),o=ee(t),c=`${o>=0?"+":"-"}${`${Math.abs(o)}`.padStart(3,"0")}`;return u("tr",{className:"divide-x",children:[n("td",{className:"bg-gray-50 text-center px-2",children:e}),n(ke,{label:Ae.Hex,value:r,valueClassName:s}),n(ke,{label:Ae.Bin,value:a}),n(ke,{label:Ae.Dec,value:c})]})}),_c=R.exports.memo(()=>u("tr",{children:[n("td",{children:ue}),n("td",{}),n(ke.FlagIndicator,{}),n("td",{})]}));var me=Object.assign(Sc,{FlagIndicator:_c});const wc=()=>{const e=I(La,Sr),{ip:t,sp:s}=I(Ps),r=I(Ma);return u("div",{className:"border-b",children:[n(We,{title:"Registers"}),u("div",{className:"divide-x flex",children:[n("table",{className:"flex-1",children:n("tbody",{className:"divide-y",children:e.map((a,o)=>{const c=se[o];return n(me,{name:c,value:a},o)})})}),n("table",{className:"flex-1",children:u("tbody",{className:"divide-y",children:[n(me,{name:Le.IP,value:t,valueClassName:"bg-green-100"}),n(me,{name:Le.SP,value:s,valueClassName:"bg-blue-100"}),n(me,{name:Le.SR,value:r}),n(me.FlagIndicator,{})]})})]})]})},xc=()=>{const[e,t]=Et(!0),s=e?sn:nn,r=I(As),a=r!==Te.Source,o=I(Yr),c=I(qr),h=a?o():c(),{ip:g,sp:l}=I(Ps);return u("div",{className:P({"border-b":e}),children:[n(We,{title:"Memory",onClick:t,children:n("span",{className:"w-4",children:n(s,{className:"mx-auto fill-gray-400 w-2.5"})})}),e&&n("table",{className:"text-sm w-full",children:u("tbody",{className:"divide-y",children:[u("tr",{className:"divide-x bg-gray-50 text-gray-400",children:[n("td",{}),he(16).map(E=>n("td",{className:"text-center",children:n("span",{className:"px-1",children:te(E)[1]})},E))]}),h.map((E,C)=>u("tr",{className:"divide-x",children:[n("td",{className:"bg-gray-50 text-center text-gray-400",children:n("span",{className:"px-1",children:te(C)[1]})}),E.map((N,L)=>{const b=C*16+L;return n("td",{className:P("text-center",{"bg-blue-50":l<b&&b<=mt&&a}),children:n("span",{className:P("px-1",{"rounded bg-green-100":b===g,"rounded bg-blue-100":b===l&&a}),children:r===Te.Hexadecimal?te(N):N})},L)})]},C))]})})]})},yc=()=>{const e=T(),t=I(pe),s=I(Fa),r=R.exports.useRef(null),a=()=>{window.setTimeout(()=>{var g;(g=r.current)==null||g.focus()})},o=g=>{e.dispatch(Ja({content:g,port:Rt.SimulatedKeyboard})),e.dispatch(Ce(!1)),e.dispatch(Vs(!1))};return u(yt,{className:"bg-black flex bg-opacity-80 inset-0 fixed items-center justify-center",isOpen:t&&s,children:[n("div",{className:"border rounded bg-light-100 py-2 px-4",children:"Waiting for keyboard input"}),n("input",{ref:r,autoFocus:!0,className:"-z-1 absolute",onBlur:a,onChange:({target:g})=>{const l=g.value;o(l.charCodeAt(0))},onKeyDown:g=>{switch(g.key){case"Backspace":o(Re.BS);break;case"Tab":g.preventDefault(),o(Re.TAB);break;case"Enter":o(Re.CR);break;case"Escape":o(Ts);break}}})]})},Lt=({name:e,onClickClose:t,children:s,className:r})=>u("div",{className:"border shadow m-1",children:[n(We,{title:e,children:n("span",{className:"rounded-full flex bg-gray-200 h-4 w-4 justify-center group",onClick:t,children:n(Eo,{className:"fill-none w-2 group-hover:fill-gray-400"})})}),n("div",{className:P("p-1",r),children:s})]}),Dt=e=>{const t=T(),s=I(Ha(e)),r=I(Wa(e)),a=R.exports.useCallback(()=>{t.dispatch(Js(e))},[]);return R.exports.useEffect(()=>{if(!r)return F(Ws,({name:o})=>{o===e&&a()})},[r]),{data:s,isVisible:r,toggleVisible:a}},Nc=()=>{const e=Dt(le.VisualDisplayUnit);return R.exports.useEffect(()=>F(ks,(t,s)=>{const r=gt(s.getState());s.dispatch(Hs(r))}),[]),e},Ic=()=>{const{data:e,isVisible:t,toggleVisible:s}=Nc();return t?n(Lt,{className:"flex flex-col space-y-1",name:"Visual Display Unit",onClickClose:s,children:dt(16,_r(e)).map((r,a)=>n("div",{className:"flex space-x-1",children:r.map((o,c)=>n("div",{className:"bg-gray-200 text-center w-4.5",children:o===" "?ue:o},c))},a))}):null},Cc=R.exports.memo(()=>u(G,{children:[n("rect",{fill:"#a1a1aa",height:"120",width:"320",x:"0",y:"120",children:n("title",{children:"Background"})}),u("g",{fill:"#000",children:[n("title",{children:"Pillar"}),n("rect",{height:"112",width:"48",x:"32",y:"24"}),n("rect",{height:"80",width:"16",x:"48",y:"136"}),n("rect",{height:"12",width:"32",x:"40",y:"216"}),n("rect",{height:"112",width:"48",x:"232",y:"24"}),n("rect",{height:"80",width:"16",x:"248",y:"136"}),n("rect",{height:"12",width:"32",x:"240",y:"216"})]}),u("g",{fill:"none",stroke:"#fff",strokeWidth:"2",children:[n("title",{children:"Circut"}),n("polyline",{points:"44,44 36,44 36,132 52,132 52,180 100,180 100,200"}),n("polyline",{points:"44,76 40,76 40,128 56,128 56,176 116,176 116,200"}),n("polyline",{points:"68,108 72,108 72,132 60,132 60,172 132,172 132,200"}),n("polyline",{points:"244,44 236,44 236,132 252,132 252,172 148,172 148,200"}),n("polyline",{points:"244,76 240,76 240,128 256,128 256,176 164,176 164,200"}),n("polyline",{points:"268,108 272,108 272,132 260,132 260,180 180,180 180,200"}),n("polyline",{points:"196,200 196,184 276,184 276,160"}),n("polyline",{points:"212,200 212,188 280,188 280,164"})]}),u("g",{fill:"#fff",children:[n("title",{children:"Circut Node"}),he(8).map(e=>n("rect",{height:"8",width:"8",x:96+e*16,y:"200"},e))]}),u("g",{fill:"#fff",textAnchor:"middle",children:[n("title",{children:"Label"}),n("text",{x:"24",y:"210",children:"MSB"}),n("text",{x:"288",y:"210",children:"LSB"})]})]})),Lc=["red","yellow","lime"],Dc=()=>{const{data:e,isVisible:t,toggleVisible:s}=Dt(le.TrafficLights);return t?n(Lt,{name:"Traffic Lights",onClickClose:s,children:u("svg",{viewBox:"0 0 312 240",width:"312",xmlns:"http://www.w3.org/2000/svg",children:[u("g",{children:[n("title",{children:"Static Layer"}),n(Cc,{})]}),u("g",{children:[n("title",{children:"Lights Layer"}),he(6).map(r=>{const a=Boolean(e[r]);return n("circle",{cx:r<3?56:256,cy:44+r%3*32,fill:a?Lc[r%3]:"none",r:"12"},r)})]}),u("g",{fill:"#fff",textAnchor:"middle",children:[n("title",{children:"Data Layer"}),e.map((r,a)=>n("text",{x:100+a*16,y:"224",children:r},a))]})]})}):null},Ac=R.exports.memo(()=>u(G,{children:[n("rect",{fill:"#a1a1aa",height:"300",width:"320",children:n("title",{children:"Background"})}),u("g",{fill:"#000",children:[n("title",{children:"Screen"}),n("rect",{height:"128",width:"80",x:"40",y:"56"}),n("rect",{height:"128",width:"80",x:"192",y:"56"})]}),u("g",{fill:"none",stroke:"#fff",strokeWidth:"2",children:[n("title",{children:"Circut"}),u("g",{children:[n("title",{children:"Digit 0"}),n("polyline",{points:"100,260 100,248 20,248 20,40 232,40 232,64"}),n("line",{x1:"80",x2:"80",y1:"40",y2:"64"}),n("line",{x1:"56",x2:"104",y1:"64",y2:"64"}),n("line",{x1:"208",x2:"256",y1:"64",y2:"64"})]}),u("g",{children:[n("title",{children:"Digit 1"}),n("polyline",{points:"116,260 116,240 28,240 28,48 188,48 188,92 204,92"}),n("line",{x1:"28",x2:"52",y1:"92",y2:"92"}),n("line",{x1:"52",x2:"52",y1:"68",y2:"116"}),n("line",{x1:"204",x2:"204",y1:"68",y2:"116"})]}),u("g",{children:[n("title",{children:"Digit 2"}),n("polyline",{points:"132,260 132,232 36,232 36,148 52,148"}),n("polyline",{points:"132,232 208,232 208,192 188,192 188,148 204,148"}),n("line",{x1:"52",x2:"52",y1:"124",y2:"172"}),n("line",{x1:"204",x2:"204",y1:"124",y2:"172"})]}),u("g",{children:[n("title",{children:"Digit 3"}),n("polyline",{points:"148,260 148,224 80,224 80,176"}),n("polyline",{points:"148,224 232,224 232,176"}),n("line",{x1:"56",x2:"104",y1:"176",y2:"176"}),n("line",{x1:"208",x2:"256",y1:"176",y2:"176"})]}),u("g",{children:[n("title",{children:"Digit 4"}),n("polyline",{points:"164,260 164,216 124,216 124,148 108,148"}),n("polyline",{points:"164,216 276,216 276,148 260,148"}),n("line",{x1:"108",x2:"108",y1:"124",y2:"172"}),n("line",{x1:"260",x2:"260",y1:"124",y2:"172"})]}),u("g",{children:[n("title",{children:"Digit 5"}),n("polyline",{points:"180,260 180,208 132,208 132,120 56,120"}),n("polyline",{points:"180,208 284,208 284,120 208,120"})]}),u("g",{children:[n("title",{children:"Digit 6"}),n("polyline",{points:"196,260 196,200 140,200 140,92 108,92"}),n("polyline",{points:"196,200 292,200 292,92 260,92"}),n("line",{x1:"108",x2:"108",y1:"68",y2:"116"}),n("line",{x1:"260",x2:"260",y1:"68",y2:"116"})]}),u("g",{children:[n("title",{children:"Digit 7"}),n("polyline",{points:"212,260 212,240 300,240 300,24 204,24"}),u("g",{fill:"#a1a1aa",children:[n("title",{children:"Inverter"}),n("polygon",{points:"204,24 204,14 194,24 204,34 204,24"}),n("circle",{cx:"190",cy:"24",r:"2"})]}),n("polyline",{points:"188,24 118,24 118,56"}),n("line",{x1:"270",x2:"270",y1:"24",y2:"56"})]})]}),u("g",{fill:"#fff",children:[n("title",{children:"Circut Node"}),he(8).map(e=>n("rect",{height:"8",width:"8",x:96+e*16,y:"260"},e)),he(5).map(e=>n("rect",{height:"4",width:"8",x:128+e*16,y:230-e*8},e)),n("rect",{height:"4",width:"8",x:"76",y:"38"}),n("rect",{height:"4",width:"8",x:"24",y:"90"}),n("rect",{height:"4",width:"8",x:"266",y:"22"}),n("rect",{height:"8",width:"8",x:"266",y:"54"}),n("rect",{height:"8",width:"8",x:"114",y:"54"})]}),u("g",{fill:"#fff",textAnchor:"middle",children:[n("title",{children:"Label"}),n("text",{x:"60",y:"270",children:"MSB"}),n("text",{x:"252",y:"270",children:"LSB"})]})]})),kc=[n("polygon",{points:"56,64 104,64 96,72 64,72"},0),n("polygon",{points:"208,64 256,64 248,72 216,72"},1),n("polygon",{points:"52,68 60,76 60,108 52,116"},2),n("polygon",{points:"204,68 212,76 212,108 204,116"},3),n("polygon",{points:"52,124 60,132 60,164 52,172"},4),n("polygon",{points:"204,124 212,132 212,164 204,172"},5),n("polygon",{points:"56,176 64,168 96,168 104,176"},6),n("polygon",{points:"208,176 216,168 248,168 256,176"},7),n("polygon",{points:"108,124 108,172 100,164 100,132"},8),n("polygon",{points:"260,124 260,172 252,164 252,132"},9),n("polygon",{points:"56,120 60,116 100,116 104,120 100,124 60,124"},10),n("polygon",{points:"208,120 212,116 252,116 256,120 252,124 212,124"},11),n("polygon",{points:"108,68 108,116 100,108 100,76"},12),n("polygon",{points:"260,68 260,116 252,108 252,76"},13)],ns=new Array(14).fill(0),Mc=()=>{const[e,t]=R.exports.useState(ns);R.exports.useEffect(()=>F(zs,()=>{t(ns)}),[]);const{data:s,isVisible:r,toggleVisible:a}=Dt(le.SevenSegmentDisplay);return R.exports.useEffect(()=>{const o=as(e,c=>{for(let h=s[7];h<14;h+=2)c[h]=s[Math.floor(h/2)]});t(o)},[s]),r?n(Lt,{name:"Seven-segment Display",onClickClose:a,children:u("svg",{viewBox:"0 0 320 300",width:"320",xmlns:"http://www.w3.org/2000/svg",children:[u("g",{children:[n("title",{children:"Static Layer"}),n(Ac,{})]}),u("g",{fill:"lime",stroke:"lime",strokeWidth:"2",children:[n("title",{children:"Segments Layer"}),kc.filter((o,c)=>e[c]===1)]}),u("g",{fill:"#fff",textAnchor:"middle",children:[n("title",{children:"Data Layer"}),s.map((o,c)=>n("text",{x:100+c*16,y:"284",children:o},c))]})]})}):null},Tc=()=>{const[e,t]=Et(!0);return u("div",{children:[n(We,{title:"I/O Devices",onClick:t,children:n("span",{className:"w-4",children:n(e?sn:nn,{className:"mx-auto fill-gray-400 w-2.5"})})}),n(yc,{}),e&&u("div",{className:"flex flex-wrap py-1 px-1 items-start",children:[n(Ic,{}),n(Dc,{}),n(Mc,{})]})]})},Oc=()=>{var o;const e=T(),t=I(Ka),s=t!==null,r=R.exports.useCallback(()=>{e.dispatch(Xa())},[]),a=St(r);return n(yt,{className:"bg-white flex bg-opacity-80 inset-0 z-50 fixed items-center justify-center",isOpen:s,children:u("div",{ref:a,className:"border rounded space-y-2 bg-light-100 shadow py-2 px-4 select-text all:select-text",children:[s?(o=t.stack)==null?void 0:o.split(/\n(.*)/s).slice(0,-1).map((c,h)=>h===0?n("div",{children:c.split(": ").map((l,E)=>n("div",{className:E===0?"text-xl text-red-500":"border-b text-lg py-1",children:l},E))},h):n("div",{className:"rounded bg-red-50 py-2 px-5.5 text-gray-600 whitespace-pre-line",children:c},h)):null,u("div",{children:["Please report this bug at"," ",n(be,{href:"https://github.com/exuanbo/assembler-simulator/issues",children:"https://github.com/exuanbo/assembler-simulator/issues"}),"."]})]})})};function Gc(e={}){const{immediate:t=!1,onNeedRefresh:s,onOfflineReady:r,onRegistered:a,onRegisterError:o}=e;let c,h;const g=async(l=!0)=>{l&&(c==null||c.addEventListener("controlling",E=>{E.isUpdate&&window.location.reload()})),h&&h.waiting&&await Xn(h.waiting,{type:"SKIP_WAITING"})};if("serviceWorker"in navigator){c=new Kn("./sw.js",{scope:"./",type:"classic"}),c.addEventListener("activated",l=>{l.isUpdate||r==null||r()});{const l=()=>{s==null||s()};c.addEventListener("waiting",l),c.addEventListener("externalwaiting",l)}c.register({immediate:t}).then(l=>{h=l,a==null||a(l)}).catch(l=>{o==null||o(l)})}return g}function Bc(e={}){const{immediate:t=!0,onNeedRefresh:s,onOfflineReady:r,onRegistered:a,onRegisterError:o}=e,[c,h]=R.exports.useState(!1),[g,l]=R.exports.useState(!1),[E]=R.exports.useState(()=>Gc({immediate:t,onOfflineReady(){l(!0),r==null||r()},onNeedRefresh(){h(!0),s==null||s()},onRegistered:a,onRegisterError:o}));return{needRefresh:[c,h],offlineReady:[g,l],updateServiceWorker:E}}const rs=({onClick:e,children:t})=>n("div",{className:"border rounded bg-gray-100 py-1 px-2 inline-block hover:bg-gray-200",onClick:e,children:t}),Pc=()=>{const{needRefresh:[e,t],updateServiceWorker:s}=Bc(),[r,a]=R.exports.useState(!1);return r?n("div",{className:"bg-white flex bg-opacity-80 inset-0 z-10 fixed justify-center items-center",children:n(So,{className:"animate-spin w-6"})}):e?u("div",{className:"border rounded space-y-2 bg-light-100 shadow py-2 px-4 right-4 bottom-4 fixed",children:[n("div",{children:"New version is available"}),u("div",{className:"space-x-2",children:[n(rs,{onClick:async()=>{a(!0),await s(!0)},children:"Reload"}),n(rs,{onClick:()=>{t(!1)},children:"Close"})]})]}):null},Uc=Z(Cr,Hr,(e,t)=>({editor:e,controller:t})),Fc=()=>(R.exports.useEffect(()=>Pe(Uc,e=>{so(e)}),[]),u(G,{children:[u("div",{className:"flex flex-col",children:[n(_i,{}),u(xi,{className:"h-[calc(100vh-2rem)] w-full top-8 fixed",children:[n(Ni,{children:n(bc,{})}),u("div",{className:"flex flex-col h-full overflow-y-auto",children:[n(wc,{}),n(xc,{}),n(Tc,{})]})]})]}),n(Pc,{}),n(Oc,{})]})),Vc=document.getElementById("app-root"),Hc=Zn.createRoot(Vc);Hc.render(n(Yn.StrictMode,{children:n(qn,{store:ro,children:n(Fc,{})})}));
